(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,74969,(e,t,r)=>{var n={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,s=l(e),a=s[0],o=s[1],u=new i((a+o)*3/4-o),h=0,c=o>0?a-4:a;for(r=0;r<c;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[h++]=t>>16&255,u[h++]=t>>8&255,u[h++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[h++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[h++]=t>>8&255,u[h++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],a=0,o=n-i;a<o;a+=16383)s.push(function(e,t,n){for(var i,s=[],a=t;a<n;a+=3)i=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===i?s.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&s.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),s.join("")};for(var r=[],n=[],i="u">typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)r[a]=s[a],n[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n[45]=62,n[95]=63},72:function(e,t,r){"use strict";var n=r(675),i=r(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return h(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var n=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|f(n,i),l=a(s),u=l.write(n,i);return u!==s&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(D(e,ArrayBuffer)||e&&D(e.buffer,ArrayBuffer)||"u">typeof SharedArrayBuffer&&(D(e,SharedArrayBuffer)||e&&D(e.buffer,SharedArrayBuffer)))return function(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),n}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return o.from(h,t,r);var p=function(e){if(o.isBuffer(e)){var t=0|d(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(p)return p;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!o.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(u(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return h(e)},o.allocUnsafeSlow=function(e){return h(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return S(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return C(e).length;default:if(i)return n?-1:S(e).length;t=(""+t).toLowerCase(),i=!0}}function p(e,t,r){var i,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=N[e[s]];return i}(this,t,r);case"utf8":case"utf-8":return w(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return i=this,s=t,a=r,0===s&&a===i.length?n.fromByteArray(i):n.fromByteArray(i.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function g(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,i){var s;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r*=1)!=s&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return y(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function y(e,t,r,n,i){var s,a=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=r;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),D(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(D(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(n,i),i+=s.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?w(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,i){if(D(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var s=i-n,a=r-t,l=Math.min(s,a),u=this.slice(n,i),h=e.slice(t,r),c=0;c<l;++c)if(u[c]!==h[c]){s=u[c],a=h[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)};function w(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=r)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}var d=n,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return p}function v(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function b(e,t,r,n,i,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function E(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function I(e,t,r,n,s){return t*=1,r>>>=0,s||E(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function _(e,t,r,n,s){return t*=1,r>>>=0,s||E(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return i=t,s=r,A(S(e,this.length-i),this,i,s);case"ascii":return a=t,o=r,A(x(e),this,a,o);case"latin1":case"binary":return function(e,t,r,n){return A(x(t),e,r,n)}(this,e,t,r);case"base64":return l=t,u=r,A(C(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=r,A(function(e,t){for(var r,n,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||v(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||v(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||v(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||v(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||v(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||v(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||v(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;b(this,e,t,r,i,0)}var s=r-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);b(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||b(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return I(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return I(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return _(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return _(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var s=i-1;s>=0;--s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=o.isBuffer(e)?e:o.from(e,n),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%l]}return this};var T=/[^+/0-9A-Za-z-_]/g;function S(e,t){t=t||1/0;for(var r,n=e.length,i=null,s=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function x(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function C(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(T,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function D(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var N=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},783:function(e,t){t.read=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,h=-7,c=r?i-1:0,d=r?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=n;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=u}return(f?-1:1)*a*Math.pow(2,s-n)},t.write=function(e,t,r,n,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=n?0:s-1,p=n?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[r+f]=255&a,f+=p,a/=256,u-=8);e[r+f-p]|=128*g}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}},a=!0;try{n[e](r,r.exports,s),a=!1}finally{a&&delete i[e]}return r.exports}s.ab="/ROOT/projects/bdd-test-dashboard/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},75724,97173,26915,96364,e=>{"use strict";let t,r,n;var i,s,a,o,l,u,h,c,d,f,p,g,m,y,w,v,b=e.i(85749);let E=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},I=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),n.push(r[u],r[h],r[c],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(E(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):I(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new T;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class T extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let S=function(e){let t=E(e);return _.encodeByteArray(t,!0)},x=function(e){return S(e).replace(/\./g,"")},C=function(e){try{return _.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function A(){return"u">typeof self?self:"u">typeof window?window:e.g}let D=()=>{try{return A().__FIREBASE_DEFAULTS__||(()=>{if(void 0===b.default||void 0===b.default.env)return;let e=b.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("u"<typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&C(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},N=()=>D()?.config;class k{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function R(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function O(e){return(await fetch(e,{credentials:"include"})).ok}let M={},L=!1;function P(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function F(){let t=D()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function V(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function B(){return!F()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function U(){return!F()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function q(){try{return"object"==typeof indexedDB}catch(e){return!1}}class j extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,j.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,z.prototype.create)}}class z{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,n;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(r=a,n=i,r.replace($,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new j(s,l,i)}}let $=/\{\$([^}]+)}/g;function G(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(K(r)&&K(s)){if(!G(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function K(e){return null!==e&&"object"==typeof e}function H(e){return e&&e._delegate?e._delegate:e}class Q{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let W="[DEFAULT]";class J{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new k;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:W})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=W){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=W){return this.instances.has(e)}getOptions(e=W){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);let i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===W?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=W){return this.component?this.component.multipleInstances?e:W:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Y{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new J(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let X=[];(i=s||(s={}))[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT";let Z={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},ee=s.INFO,et={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},er=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=et[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class en{constructor(e){this.name=e,this._logLevel=ee,this._logHandler=er,this._userLogHandler=null,X.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?Z[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}let ei=new WeakMap,es=new WeakMap,ea=new WeakMap,eo=new WeakMap,el=new WeakMap,eu={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return es.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ea.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return eh(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eh(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eh(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&ei.set(t,e)}).catch(()=>{}),el.set(t,e),t}if(eo.has(e))return eo.get(e);let n=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(ec(this),t),eh(ei.get(this))}:function(...t){return eh(e.apply(ec(this),t))}:function(t,...r){let n=e.call(ec(this),t,...r);return ea.set(n,t.sort?t.sort():[t]),eh(n)};return e instanceof IDBTransaction&&function(e){if(es.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});es.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,eu):e}(e);return n!==e&&(eo.set(e,n),el.set(n,e)),n}let ec=e=>el.get(e),ed=["get","getKey","getAll","getAllKeys","count"],ef=["put","add","delete","clear"],ep=new Map;function eg(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(ep.get(t))return ep.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=ef.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||ed.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return ep.set(t,s),s}eu={...n=eu,get:(e,t,r)=>eg(e,t)||n.get(e,t,r),has:(e,t)=>!!eg(e,t)||n.has(e,t)};class em{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let ey="@firebase/app",ew="0.14.8",ev=new en("@firebase/app"),eb="[DEFAULT]",eE={[ey]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eI=new Map,e_=new Map,eT=new Map;function eS(e,t){try{e.container.addComponent(t)}catch(r){ev.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function ex(e,t){e.container.addOrOverwriteComponent(t)}function eC(e){let t=e.name;if(eT.has(t))return ev.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(eT.set(t,e),eI.values()))eS(r,e);for(let t of e_.values())eS(t,e);return!0}function eA(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function eD(e,t,r=eb){eA(e,t).clearInstance(r)}function eN(e){return void 0!==e.options}function ek(e){return!eN(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function eR(e){return null!=e&&void 0!==e.settings}function eO(){eT.clear()}let eM=new z("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class eL{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Q("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw eM.create("app-deleted",{appName:this._name})}}function eP(e,t){let r=C(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class eF extends eL{constructor(e,t,r,n){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:r,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,n):super(e.options,s,n),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&eP(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&eP(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,e$(ey,ew,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){ez(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw eM.create("server-app-deleted")}}let eV="12.9.0";function eB(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n={name:eb,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw eM.create("bad-app-name",{appName:String(i)});if(r||(r=N()),!r)throw eM.create("no-options");let s=eI.get(i);if(s)if(G(r,s.options)&&G(n,s.config))return s;else throw eM.create("duplicate-app",{appName:i});let a=new Y(i);for(let e of eT.values())a.addComponent(e);let o=new eL(r,n,a);return eI.set(i,o),o}function eU(e,t={}){let r;if(("u">typeof window||V())&&!V())throw eM.create("invalid-server-app-environment");let n=t||{};if(e&&(eN(e)?r=e.options:ek(e)?n=e:r=e),void 0===n.automaticDataCollectionEnabled&&(n.automaticDataCollectionEnabled=!0),r||(r=N()),!r)throw eM.create("no-options");let i={...n,...r};if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==n.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw eM.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),a=e_.get(s);if(a)return a.incRefCount(n.releaseOnDeref),a;let o=new Y(s);for(let e of eT.values())o.addComponent(e);let l=new eF(r,n,s,o);return e_.set(s,l),l}function eq(e=eb){let t=eI.get(e);if(!t&&e===eb&&N())return eB();if(!t)throw eM.create("no-app",{appName:e});return t}function ej(){return Array.from(eI.values())}async function ez(e){let t=!1,r=e.name;eI.has(r)?(t=!0,eI.delete(r)):e_.has(r)&&0>=e.decRefCount()&&(e_.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function e$(e,t,r){let n=eE[e]??e;r&&(n+=`-${r}`);let i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ev.warn(e.join(" "));return}eC(new Q(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function eG(e,t){if(null!==e&&"function"!=typeof e)throw eM.create("invalid-log-argument");for(let r of X){let n=null;t&&t.level&&(n=Z[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...i)=>{let a=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(n??t.logLevel)&&e({level:s[r].toLowerCase(),message:a,args:i,type:t.name})}}}function eK(e){X.forEach(t=>{t.setLogLevel(e)})}let eH="firebase-heartbeat-store",eQ=null;function eW(){return eQ||(eQ=(function(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=eh(a);return n&&a.addEventListener("upgradeneeded",e=>{n(eh(a.result),e.oldVersion,e.newVersion,eh(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(eH)}catch(e){console.warn(e)}}}).catch(e=>{throw eM.create("idb-open",{originalErrorMessage:e.message})})),eQ}async function eJ(e){try{let t=(await eW()).transaction(eH),r=await t.objectStore(eH).get(eX(e));return await t.done,r}catch(e){if(e instanceof j)ev.warn(e.message);else{let t=eM.create("idb-get",{originalErrorMessage:e?.message});ev.warn(t.message)}}}async function eY(e,t){try{let r=(await eW()).transaction(eH,"readwrite"),n=r.objectStore(eH);await n.put(t,eX(e)),await r.done}catch(e){if(e instanceof j)ev.warn(e.message);else{let t=eM.create("idb-set",{originalErrorMessage:e?.message});ev.warn(t.message)}}}function eX(e){return`${e.name}!${e.options.appId}`}class eZ{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new e1(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=e0();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ev.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=e0(),{heartbeatsToSend:t,unsentEntries:r}=function(e,t=1024){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),e2(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),e2(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),n=x(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return ev.warn(e),""}}}function e0(){return new Date().toISOString().substring(0,10)}class e1{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!q()&&new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await eJ(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return eY(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return eY(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function e2(e){return x(JSON.stringify({version:2,heartbeats:e})).length}eC(new Q("platform-logger",e=>new em(e),"PRIVATE")),eC(new Q("heartbeat",e=>new eZ(e),"PRIVATE")),e$(ey,ew,""),e$(ey,ew,"esm2020"),e$("fire-js",""),e.s(["SDK_VERSION",()=>eV,"_DEFAULT_ENTRY_NAME",()=>eb,"_addComponent",()=>eS,"_addOrOverwriteComponent",()=>ex,"_apps",()=>eI,"_clearComponents",()=>eO,"_components",()=>eT,"_getProvider",()=>eA,"_isFirebaseApp",()=>eN,"_isFirebaseServerApp",()=>eR,"_isFirebaseServerAppSettings",()=>ek,"_registerComponent",()=>eC,"_removeServiceInstance",()=>eD,"_serverApps",()=>e_,"deleteApp",()=>ez,"getApp",()=>eq,"getApps",()=>ej,"initializeApp",()=>eB,"initializeServerApp",()=>eU,"onLog",()=>eG,"registerVersion",()=>e$,"setLogLevel",()=>eK],3483),e$("firebase","12.9.0","app"),e.i(3483);var e6=e.i(74969),e3="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,e5={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function r(){}function n(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let r=t-this.blockSize,i=this.C,s=this.h,a=0;for(;a<t;){if(0==s)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){n(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var s,l={};function u(e){var t;return -128<=e&&e<128?(t=function(e){return new i([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(l,e)?l[e]:l[e]=t(e)):new i([0|e],e<0?-1:0)}function h(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return m(h(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new i(t,0)}var c=u(0),d=u(1),f=u(0x1000000);function p(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return -1==e.h}function m(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new i(r,~e.h).add(d)}function y(e,t){return e.add(m(t))}function w(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function b(e,t){if(p(t))throw Error("division by zero");if(p(e))return new v(c,c);if(g(e))return t=b(m(e),t),new v(m(t.g),m(t.h));if(g(t))return t=b(e,m(t)),new v(m(t.g),t.h);if(e.g.length>30){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var r=d,n=t;0>=n.l(e);)r=E(r),n=E(n);var i=I(r,1),s=I(n,1);for(n=I(n,2),r=I(r,2);!p(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=I(n,1),r=I(r,1)}return t=y(e,i.j(t)),new v(i,t)}for(i=c;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=h(r)).j(t);g(a)||a.l(e)>0;)r-=n,a=(s=h(r)).j(t);p(s)&&(s=d),i=i.add(s),e=y(e,a)}return new v(i,e)}function E(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new i(r,e.h)}function I(e,t){let r=t>>5;t%=32;let n=e.g.length-r,s=[];for(let i=0;i<n;i++)s[i]=t>0?e.i(i+r)>>>t|e.i(i+r+1)<<32-t:e.i(i+r);return new i(s,e.h)}(s=i.prototype).m=function(){if(g(this))return-m(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},s.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(g(this))return"-"+m(this).toString(e);let t=h(Math.pow(e,6));var r=this;let n="";for(;;){let i=b(r,t).g,s=(((r=y(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(p(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},s.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return g(e=y(this,e))?-1:+!p(e)},s.abs=function(){return g(this)?m(this):this},s.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],n=0;for(let i=0;i<=t;i++){let t=n+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);n=s>>>16,t&=65535,s&=65535,r[i]=s<<16|t}return new i(r,-0x80000000&r[r.length-1]?-1:0)},s.j=function(e){if(p(this)||p(e))return c;if(g(this))return g(e)?m(this).j(m(e)):m(m(this).j(e));if(g(e))return m(this.j(m(e)));if(0>this.l(f)&&0>e.l(f))return h(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){let i=this.i(n)>>>16,s=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);r[2*n+2*t]+=s*o,w(r,2*n+2*t),r[2*n+2*t+1]+=i*o,w(r,2*n+2*t+1),r[2*n+2*t+1]+=s*a,w(r,2*n+2*t+1),r[2*n+2*t+2]+=i*a,w(r,2*n+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new i(r,0)},s.B=function(e){return b(this,e).h},s.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new i(r,this.h&e.h)},s.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new i(r,this.h|e.h)},s.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new i(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,o=e5.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=h,i.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return m(e(t.substring(1),r));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let n=h(Math.pow(r,8)),i=c;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),r);s<8?(s=h(Math.pow(r,s)),i=i.j(s).add(h(a))):i=(i=i.j(n)).add(h(a))}return i},a=e5.Integer=i}).apply(void 0!==e3?e3:"u">typeof self?self:"u">typeof window?window:{});var e4="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,e8={};(function(){var e,t,r=Object.defineProperty,n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof e4&&e4];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&r(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function m(e,t,r){return e.call.apply(e.bind,arguments)}function y(e,t,r){return(y=m).apply(null,arguments)}function w(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function v(e,t){function r(){}r.prototype=t.prototype,e.Z=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Ob=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}var b="u">typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function E(e){let t=e.length;if(t>0){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function I(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];var r=typeof n;if("array"==(r="object"!=r?r:n?Array.isArray(n)?"array":r:"null")||"object"==r&&"number"==typeof n.length){r=e.length||0;let t=n.length||0;e.length=r+t;for(let i=0;i<t;i++)e[r+i]=n[i]}else e.push(n)}}var _=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new T,e=>e.reset());class T{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let S,x=!1,C=new class{constructor(){this.h=this.g=null}add(e,t){let r=_.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},A=()=>{let e=Promise.resolve(void 0);S=()=>{e.then(D)}};function D(){let e;for(var t;e=null,C.g&&(e=C.g,C.g=C.g.next,C.g||(C.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}_.j(t),_.h<100&&(_.h++,t.next=_.g,_.g=t)}x=!1}function N(){this.u=this.u,this.C=this.C}function k(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}N.prototype.u=!1,N.prototype.dispose=function(){this.u||(this.u=!0,this.N())},N.prototype[Symbol.dispose]=function(){this.dispose()},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},k.prototype.h=function(){this.defaultPrevented=!0};var R=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function O(e){return/^[\s\xa0]*$/.test(e)}function M(e,t){k.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}v(M,k),M.prototype.init=function(e,t){let r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&M.Z.h.call(this)},M.prototype.h=function(){M.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var L="closure_listenable_"+(1e6*Math.random()|0),P=0;function F(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++P,this.da=this.fa=!1}function V(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function U(e){let t={};for(let r in e)t[r]=e[r];return t}let q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function j(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<q.length;t++)r=q[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function z(e){this.src=e,this.g={},this.h=0}function $(e,t){let r=t.type;if(r in e.g){var n,i=e.g[r],s=Array.prototype.indexOf.call(i,t,void 0);(n=s>=0)&&Array.prototype.splice.call(i,s,1),n&&(V(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function G(e,t,r,n){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!r==s.capture&&s.ha==n)return i}return -1}z.prototype.add=function(e,t,r,n,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=G(e,t,n,i);return a>-1?(t=e[a],r||(t.fa=!1)):((t=new F(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var K="closure_lm_"+(1e6*Math.random()|0),H={};function Q(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");let a=o(i)?!!i.capture:!!i,l=X(e);if(l||(e[K]=l=new z(e)),(r=l.add(t,r,n,a,s)).proxy)return r;if(n=function e(t){return Y.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)R||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(J(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function W(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[L])$(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(J(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=X(t))?($(r,e),0==r.h&&(r.src=null,t[K]=null)):V(e)}}}function J(e){return e in H?H[e]:H[e]="on"+e}function Y(e,t){if(e.da)e=!0;else{t=new M(t,this);let r=e.listener,n=e.ha||e.src;e.fa&&W(e),e=r.call(n,t)}return e}function X(e){return(e=e[K])instanceof z?e:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[Z]||(e[Z]=function(t){return e.handleEvent(t)}),e[Z])}function et(){N.call(this),this.i=new z(this),this.M=this,this.G=null}function er(e,t){let r,n;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new k(t,e);else if(t instanceof k)t.target=t.target||e;else{var a=t;j(t=new k(s,e),a)}if(a=!0,i)for(n=i.length-1;n>=0;n--)a=en(r=t.g=i[n],s,!0,t)&&a;if(a=en(r=t.g=e,s,!0,t)&&a,a=en(r,s,!1,t)&&a,i)for(n=0;n<i.length;n++)a=en(r=t.g=i[n],s,!1,t)&&a}function en(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==r){let t=a.listener,r=a.ha||a.src;a.fa&&$(e.i,a),i=!1!==t.call(r,n)&&i}}return i&&!n.defaultPrevented}v(et,N),et.prototype[L]=!0,et.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else(i=o(i)?!!i.capture:!!i,n=ee(n),t&&t[L])?(t=t.i,(a=String(r).toString())in t.g&&(n=G(r=t.g[a],n,i,s))>-1&&(V(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[a],t.h--))):t&&(t=X(t))&&(r=t.g[r.toString()],t=-1,r&&(t=G(r,n,i,s)),(n=t>-1?r[t]:null)&&W(n))}(this,e,t,r,n)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let r=e.g[t];for(let e=0;e<r.length;e++)V(r[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},et.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ei extends N{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=y(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:a.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function es(e){N.call(this),this.h=e,this.g={}}v(es,N);var ea=[];function eo(e){B(e.g,function(e,t){this.g.hasOwnProperty(t)&&W(e)},e),e.g={}}es.prototype.N=function(){es.Z.N.call(this),eo(this)},es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=a.JSON.stringify,eu=a.JSON.parse,eh=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ec(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){k.call(this,"d")}function eg(){k.call(this,"c")}v(ep,k),v(eg,k);var em={},ey=null;function ew(){return ey=ey||new et}function ev(e){k.call(this,em.Ia,e)}function eb(e){let t=ew();er(t,new ev(t))}function eE(e,t){k.call(this,em.STAT_EVENT,e),this.stat=t}function eI(e){let t=ew();er(t,new eE(t,e))}function e_(e,t){k.call(this,em.Ja,e),this.size=t}function eT(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eS(){this.g=!0}function ex(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var r=s[e];if(!(r.length<2)){var n=r[1];if(Array.isArray(n)&&!(n.length<1)){var i=n[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<n.length;e++)n[e]=""}}}}return el(s)}catch(e){return t}}(e,r)+(n?" "+n:"")})}em.Ia="serverreachability",v(ev,k),em.STAT_EVENT="statevent",v(eE,k),em.Ja="timingevent",v(e_,k),eS.prototype.ua=function(){this.g=!1},eS.prototype.info=function(){};var eC={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eA={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eD(){}function eN(e){return encodeURIComponent(String(e))}function ek(e,t,r,n){this.j=e,this.i=t,this.l=r,this.S=n||1,this.V=new es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eR}function eR(){this.i=null,this.g="",this.h=!1}v(eD,ec),eD.prototype.g=function(){return new XMLHttpRequest},e=new eD;var eO={},eM={};function eL(e,t,r){e.M=1,e.A=e5(e0(t)),e.u=r,e.R=!0,eP(e,null)}function eP(e,t){e.F=Date.now(),eV(e),e.B=e0(e.A);var r,n,i,s,a,l,u=e.B,h=e.S;Array.isArray(h)||(h=[String(h)]),tc(u.i,"t",h),e.C=0,u=e.j.L,e.h=new eR,e.g=tY(e.j,u?t:null,!e.u),e.P>0&&(e.O=new ei(y(e.Y,e,e.g),e.P)),t=e.V,u=e.g,h=e.ba;var c="readystatechange";Array.isArray(c)||(c&&(ea[0]=c.toString()),c=ea);for(let e=0;e<c.length;e++){let r=function e(t,r,n,i,s){if(i&&i.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=ee(n),t&&t[L]?t.K(r,n,o(i)?!!i.capture:!!i,s):Q(t,r,n,!0,i,s)}(t,r,n,i,s);if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=ee(n),t&&t[L]?t.J(r,n,o(i)?!!i.capture:!!i,s):Q(t,r,n,!1,i,s)}(u,c[e],h||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}t=e.J?U(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),eb(),r=e.i,n=e.v,i=e.B,s=e.l,a=e.S,l=e.u,r.info(function(){if(r.g)if(l){var e="",t=l.split("&");for(let r=0;r<t.length;r++){var o=t[r].split("=");if(o.length>1){let t=o[0];o=o[1];let r=t.split("_");e=r.length>=2&&"type"==r[1]?e+(t+"=")+o+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+n+"\n"+i+"\n"+e})}function eF(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eV(e){e.T=Date.now()+e.H,eB(e,e.H)}function eB(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eT(y(e.aa,e),t)}function eU(e){e.D&&(a.clearTimeout(e.D),e.D=null)}function eq(e){0==e.j.I||e.K||tK(e.j,e)}function ej(e){eU(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eo(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function ez(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||eQ(r.h,e))){if(!e.L&&eQ(r.h,e)&&3==r.I){try{var n=r.Ba.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.v){if(r.g)if(r.g.F+3e3<e.F)tG(r),tL(r);else break e;tj(r),eI(18)}}else r.xa=i[1],0<r.xa-r.K&&i[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=eT(y(r.Va,r),6e3));1>=eH(r.h)&&r.ta&&(r.ta=void 0)}else tQ(r,11)}else if((e.L||r.g==e)&&tG(r),!O(t))for(i=r.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=r.K))if(r.K=l,o=o[1],2==r.I)if("c"==o[0]){r.M=o[1],r.ba=o[2];let t=o[3];null!=t&&(r.ka=t,r.j.info("VER="+r.ka));let i=o[4];null!=i&&(r.za=i,r.j.info("SVER="+r.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(r.O=n=1.5*l,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eW(s,s.h),s.h=null))}if(n.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.wa=e,e3(n.J,n.G,e))}}if(r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms")),(n=r).na=tJ(n,n.L?n.ba:null,n.W),e.L){eJ(n.h,e);var a=n.O;a&&(e.H=a),e.D&&(eU(e),eV(e)),n.g=e}else tq(n);r.i.length>0&&tF(r)}else"stop"!=o[0]&&"close"!=o[0]||tQ(r,7);else 3==r.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tQ(r,7):tM(r):"noop"!=o[0]&&r.l&&r.l.qa(o),r.A=0)}}eb(4)}catch(e){}}ek.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tN(e)?t.j():this.Y(e)},ek.prototype.Y=function(e){try{if(e==this.g)e:{let f=tN(this.g),p=this.g.ya(),g=this.g.ca();if(!(f<3)&&(3!=f||this.g&&(this.h.h||this.g.la()||tk(this.g)))){this.K||4!=f||7==p||(8==p||g<=0?eb(3):eb(2)),eU(this);var t=this.g.ca();this.X=t;var r=function(e){if(!eF(e))return e.g.la();let t=tk(e.g);if(""===t)return"";let r="",n=t.length,i=4==tN(e.g);if(!e.h.i){if("u"<typeof TextDecoder)return ej(e),eq(e),"";e.h.i=new a.TextDecoder}for(let s=0;s<n;s++)e.h.h=!0,r+=e.h.i.decode(t[s],{stream:!(i&&s==n-1)});return t.length=0,e.h.g+=r,e.C=0,e.h.g}(this);if(this.o=200==t,n=this.i,i=this.v,s=this.B,o=this.l,l=this.S,n.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+l+"]: "+i+"\n"+s+"\n"+f+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var n,i,s,o,l,u,h=this.g;if((u=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O(u)){var c=u;break t}}c=null}if(e=c)ex(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ez(this,e);else{this.o=!1,this.m=3,eI(12),ej(this),eq(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<r.length;)if((t=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eM:isNaN(r=Number(t.substring(r,n)))?eO:(n+=1)+r>t.length?eM:(t=t.slice(n,n+r),e.C=n+r,t)}(this,r))==eM){4==f&&(this.m=4,eI(14),e=!1),ex(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eO){this.m=4,eI(15),ex(this.i,this.l,r,"[Invalid Chunk]"),e=!1;break}else ex(this.i,this.l,t,null),ez(this,t);if(eF(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=r.length||this.h.h||(this.m=1,eI(16),e=!1),this.o=this.o&&e,e){if(r.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),tz(d),d.P=!0,eI(11))}}else ex(this.i,this.l,r,"[Invalid Chunked Response]"),ej(this),eq(this)}else ex(this.i,this.l,r,null),ez(this,r);4==f&&ej(this),this.o&&!this.K&&(4==f?tK(this.j,this):(this.o=!1,eV(this)))}else(function(e){let t={};e=(e.g&&tN(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(O(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;t>0&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let i=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let s=t[i]||[];t[i]=s,s.push(r)}var n=function(e){return e.join(", ")};for(let e in t)n.call(void 0,t[e],e,t)})(this.g),400==t&&r.indexOf("Unknown SID")>0?(this.m=3,eI(12)):(this.m=0,eI(13)),ej(this),eq(this)}}}catch(e){}finally{}},ek.prototype.cancel=function(){this.K=!0,ej(this)},ek.prototype.aa=function(){var e,t;this.D=null;let r=Date.now();r-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(eb(),eI(17)),ej(this),this.m=2,eq(this)):eB(this,this.T-r)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eG(e){this.l=e||10,e=a.PerformanceNavigationTiming?(e=a.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eK(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eH(e){return e.h?1:e.g?e.g.size:0}function eQ(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eW(e,t){e.g?e.g.add(t):e.h=t}function eJ(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eY(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.G);return t}return E(e.i)}eG.prototype.cancel=function(){if(this.i=eY(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eX=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e6(this,td(e.i)),this.m=e.m):e&&(t=String(e).match(eX))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e7(t[2]||""),this.g=e7(t[3]||"",!0),e2(this,t[4]),this.h=e7(t[5]||"",!0),e6(this,t[6]||"",!0),this.m=e7(t[7]||"")):(this.l=!1,this.i=new ta(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,r){e.j=r?e7(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e6(e,t,r){var n,i;t instanceof ta?(e.i=t,n=e.i,(i=e.l)&&!n.j&&(to(n),n.i=null,n.g.forEach(function(e,t){let r=t.toLowerCase();t!=r&&(tl(this,t),tc(this,r,e))},n)),n.j=i):(r||(t=e9(t,ti)),e.i=new ta(t,e.l))}function e3(e,t,r){e.i.set(t,r)}function e5(e){return e3(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e7(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e9(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,te),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function te(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e9(t,tt,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e9(t,tt,!0),"@"),e.push(eN(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.u)&&e.push(":",String(r))),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(e9(r,"/"==r.charAt(0)?tn:tr,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",e9(r,ts)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),r=!!e.j;r?e1(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var n=e.h;if(r)e2(t,e.u);else if(r=!!e.h){if("/"!=n.charAt(0))if(this.g&&!this.h)n="/"+n;else{var i=t.h.lastIndexOf("/");-1!=i&&(n=t.h.slice(0,i+1)+n)}if(".."==(i=n)||"."==i)n="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){n=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let r=i[t++];"."==r?n&&t==i.length&&e.push(""):".."==r?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),n&&t==i.length&&e.push("")):(e.push(r),n=!0)}n=e.join("/")}else n=i}return r?t.h=n:r=""!==e.i.toString(),r?e6(t,td(e.i)):r=!!e.m,r&&(t.m=e.m),t};var tt=/[#\/\?@]/g,tr=/[#\?:]/g,tn=/[#\?]/g,ti=/[#\?@]/g,ts=/#/g;function ta(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function to(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let r=0;r<e.length;r++){let n=e[r].indexOf("="),i,s=null;n>=0?(i=e[r].substring(0,n),s=e[r].substring(n+1)):i=e[r],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function tl(e,t){to(e),t=tf(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tu(e,t){return to(e),t=tf(e,t),e.g.has(t)}function th(e,t){to(e);let r=[];if("string"==typeof t)tu(e,t)&&(r=r.concat(e.g.get(tf(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function tc(e,t,r){tl(e,t),r.length>0&&(e.i=null,e.g.set(tf(e,t),E(r)),e.h+=r.length)}function td(e){let t=new ta;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tf(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tp(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function tg(){this.g=new eh}function tm(e){this.i=e.Sb||null,this.h=e.ab||!1}function ty(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tw(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function tv(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tb(e)}function tb(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tE(e){let t="";return B(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function tI(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=tE(r),"string"==typeof e?null!=r&&eN(r):e3(e,t,r))}function t_(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ta.prototype).add=function(e,t){to(this),this.i=null,e=tf(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},t.forEach=function(e,t){to(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},t.set=function(e,t){return to(this),this.i=null,tu(this,e=tf(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=th(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let n=0;n<t.length;n++){var r=t[n];let i=eN(r);r=th(this,r);for(let t=0;t<r.length;t++){let n=i;""!==r[t]&&(n+="="+eN(r[t])),e.push(n)}}return this.i=e.join("&")},v(tm,ec),tm.prototype.g=function(){return new ty(this.i,this.h)},v(ty,et),(t=ty.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tb(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||a).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,tv(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tb(this)),this.g&&(this.readyState=3,tb(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tw(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tv(this):tb(this),3==this.readyState&&tw(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,tv(this))},t.Na=function(e){this.g&&(this.response=e,tv(this))},t.ga=function(){this.g&&tv(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(ty.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),v(t_,et);var tT=/^https?$/i,tS=["POST","PUT"];function tx(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tC(e),tD(e)}function tC(e){e.A||(e.A=!0,er(e,"complete"),er(e,"error"))}function tA(e){if(e.h&&void 0!==s){if(e.v&&4==tN(e))setTimeout(e.Ca.bind(e),0);else if(er(e,"readystatechange"),4==tN(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===s){let t=String(e.D).match(eX)[1]||null;!t&&a.self&&a.self.location&&(t=a.self.location.protocol.slice(0,-1)),r=!tT.test(t?t.toLowerCase():"")}t=r}if(t)er(e,"complete"),er(e,"success");else{e.o=6;try{var i=tN(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tC(e)}}finally{tD(e)}}}}function tD(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let r=e.g;e.g=null,t||er(e,"ready");try{r.onreadystatechange=null}catch(e){}}}function tN(e){return e.g?e.g.readyState:0}function tk(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tR(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tO(e){this.za=0,this.i=[],this.j=new eS,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tR("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tR("baseRetryDelayMs",5e3,e),this.Za=tR("retryDelaySeedMs",1e4,e),this.Ta=tR("forwardChannelMaxRetries",2,e),this.va=tR("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eG(e&&e.concurrentRequestLimit),this.Ba=new tg,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tM(e){if(tP(e),3==e.I){var t=e.V++,r=e0(e.J);if(e3(r,"SID",e.M),e3(r,"RID",t),e3(r,"TYPE","terminate"),tB(e,r),(t=new ek(e,e.j,t)).M=2,t.A=e5(e0(r)),r=!1,a.navigator&&a.navigator.sendBeacon)try{r=a.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!r&&a.Image&&((new Image).src=t.A,r=!0),r||(t.g=tY(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eV(t)}tW(e)}function tL(e){e.g&&(tz(e),e.g.cancel(),e.g=null)}function tP(e){tL(e),e.v&&(a.clearTimeout(e.v),e.v=null),tG(e),e.h.cancel(),e.m&&("number"==typeof e.m&&a.clearTimeout(e.m),e.m=null)}function tF(e){if(!eK(e.h)&&!e.m){e.m=!0;var t=e.Ea;S||A(),x||(S(),x=!0),C.add(t,e),e.D=0}}function tV(e,t){var r;r=t?t.l:e.V++;let n=e0(e.J);e3(n,"SID",e.M),e3(n,"RID",r),e3(n,"AID",e.K),tB(e,n),e.u&&e.o&&tI(n,e.u,e.o),r=new ek(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tU(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eW(e.h,r),eL(r,n,t)}function tB(e,t){e.H&&B(e.H,function(e,r){e3(t,r,e)}),e.l&&B({},function(e,r){e3(t,r,e)})}function tU(e,t,r){r=Math.min(e.i.length,r);let n=e.l?y(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?r>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let u=0;u<r;u++){var s=i[u].g;let r=i[u].map;if((s-=t)<0)t=Math.max(0,i[u].g-100),l=!1;else try{s="req"+s+"_";try{var a=r instanceof Map?r:Object.entries(r);for(let[t,r]of a){let n=r;o(r)&&(n=el(r)),e.push(s+t+"="+encodeURIComponent(n))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){n&&n(r)}}if(l){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,r),a}function tq(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;S||A(),x||(S(),x=!0),C.add(t,e),e.A=0}}function tj(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eT(y(e.Da,e),tH(e,e.A)),e.A++,!0)}function tz(e){null!=e.B&&(a.clearTimeout(e.B),e.B=null)}function t$(e){e.g=new ek(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e3(t,"RID","rpc"),e3(t,"SID",e.M),e3(t,"AID",e.K),e3(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e3(t,"TO",e.ia),e3(t,"TYPE","xmlhttp"),tB(e,t),e.u&&e.o&&tI(t,e.u,e.o),e.O&&(e.g.H=e.O);var r=e.g;e=e.ba,r.M=1,r.A=e5(e0(t)),r.u=null,r.R=!0,eP(r,e)}function tG(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tK(e,t){var r,n=null;if(e.g==t){tG(e),tz(e),e.g=null;var i=2}else{if(!eQ(e.h,t))return;n=t.G,eJ(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;er(i=ew(),new e_(i,n)),tF(e)}else tq(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(r=t,!(eH(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=r.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eT(y(e.Ea,e,r),tH(e,e.D)),e.D++,!0)))||2==i&&tj(e)))switch(n&&n.length>0&&((t=e.h).i=t.i.concat(n)),s){case 1:tQ(e,5);break;case 4:tQ(e,10);break;case 3:tQ(e,6);break;default:tQ(e,2)}}}function tH(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function tQ(e,t){if(e.j.info("Error code "+t),2==t){let t,s,o;var r,n=y(e.bb,e),i=e.Ua;let l=!i;i=new eZ(i||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e1(i,"https"),e5(i),l?function(e,t){let r=new eS;if(a.Image){let n=new Image;n.onload=w(tp,r,"TestLoadImage: loaded",!0,t,n),n.onerror=w(tp,r,"TestLoadImage: error",!1,t,n),n.onabort=w(tp,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=w(tp,r,"TestLoadImage: timeout",!1,t,n),a.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(i.toString(),n):(r=i.toString(),t=new eS,s=new AbortController,o=setTimeout(()=>{s.abort(),tp(t,"TestPingServer: timeout",!1,n)},1e4),fetch(r,{signal:s.signal}).then(e=>{clearTimeout(o),e.ok?tp(t,"TestPingServer: ok",!0,n):tp(t,"TestPingServer: server error",!1,n)}).catch(()=>{clearTimeout(o),tp(t,"TestPingServer: error",!1,n)}))}else eI(2);e.I=0,e.l&&e.l.pa(t),tW(e),tP(e)}function tW(e){if(e.I=0,e.ja=[],e.l){let t=eY(e.h);(0!=t.length||0!=e.i.length)&&(I(e.ja,t),I(e.ja,e.i),e.h.i.length=0,E(e.i),e.i.length=0),e.l.oa()}}function tJ(e,t,r){var n=r instanceof eZ?e0(r):new eZ(r);if(""!=n.g)t&&(n.g=t+"."+n.g),e2(n,n.u);else{var i=a.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new eZ(null);n&&e1(e,n),t&&(e.g=t),i&&e2(e,i),r&&(e.h=r),n=e}return r=e.G,t=e.wa,r&&t&&e3(n,r,t),e3(n,"VER",e.ka),tB(e,n),n}function tY(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new t_(e.Aa&&!e.ma?new tm({ab:r}):e.ma)).Fa(e.L),t}function tX(){}function tZ(){}function t0(e,t){et.call(this),this.g=new tO(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!O(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!O(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t6(this)}function t1(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t2(){eg.call(this),this.status=1}function t6(e){this.g=e}(t=t_.prototype).Fa=function(e){this.H=e},t.ea=function(t,r,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);r=r?r.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=b(y(this.Ca,this));try{this.B=!0,this.g.open(r,String(t),!0),this.B=!1}catch(e){tx(this,e);return}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,o]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&t instanceof a.FormData,!(Array.prototype.indexOf.call(tS,r,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(e,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tx(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,er(this,"complete"),er(this,"abort"),tD(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tD(this,!0)),t_.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tA(this):this.Xa())},t.Xa=function(){tA(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tN(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eu(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tO.prototype).ka=8,t.I=1,t.connect=function(e,t,r,n){eI(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.J=tJ(this,null,this.W),tF(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new ek(this,this.j,e),s=this.o;if(this.U&&(s?j(s=U(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if((t+=n)>4096){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tU(this,i,t),e3(r=e0(this.J),"RID",e),e3(r,"CVER",22),this.G&&e3(r,"X-HTTP-Session-Id",this.G),tB(this,r),s&&(this.R?t="headers="+eN(tE(s))+"&"+t:this.u&&tI(r,this.u,s)),eW(this.h,i),this.Ra&&e3(r,"TYPE","init"),this.S?(e3(r,"$req",t),e3(r,"SID","null"),i.U=!0,eL(i,r,null)):eL(i,r,t),this.I=2}}else 3==this.I&&(e?tV(this,e):0==this.i.length||eK(this.h)||tV(this))},t.Da=function(){if(this.v=null,t$(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eT(y(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eI(10),tL(this),t$(this))},t.Va=function(){null!=this.C&&(this.C=null,tL(this),tj(this),eI(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eI(2)):(this.j.info("Failed to ping google.com"),eI(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tX.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tZ.prototype.g=function(e,t){return new t0(e,t)},v(t0,et),t0.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},t0.prototype.close=function(){tM(this.g)},t0.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.v&&((r={}).__data__=el(e),e=r);t.i.push(new e$(t.Ya++,e)),3==t.I&&tF(t)},t0.prototype.N=function(){this.g.l=null,delete this.j,tM(this.g),delete this.g,t0.Z.N.call(this)},v(t1,ep),v(t2,eg),v(t6,tX),t6.prototype.ra=function(){er(this.g,"a")},t6.prototype.qa=function(e){er(this.g,new t1(e))},t6.prototype.pa=function(e){er(this.g,new t2)},t6.prototype.oa=function(){er(this.g,"b")},tZ.prototype.createWebChannel=tZ.prototype.g,t0.prototype.send=t0.prototype.o,t0.prototype.open=t0.prototype.m,t0.prototype.close=t0.prototype.close,g=e8.createWebChannelTransport=function(){return new tZ},p=e8.getStatEventTarget=function(){return ew()},f=e8.Event=em,d=e8.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eC.NO_ERROR=0,eC.TIMEOUT=8,eC.HTTP_ERROR=6,c=e8.ErrorCode=eC,eA.COMPLETE="complete",h=e8.EventType=eA,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",et.prototype.listen=et.prototype.J,u=e8.WebChannel=ed,e8.FetchXmlHttpFactory=tm,t_.prototype.listenOnce=t_.prototype.K,t_.prototype.getLastError=t_.prototype.Ha,t_.prototype.getLastErrorCode=t_.prototype.ya,t_.prototype.getStatus=t_.prototype.ca,t_.prototype.getResponseJson=t_.prototype.La,t_.prototype.getResponseText=t_.prototype.la,t_.prototype.send=t_.prototype.ea,t_.prototype.setWithCredentials=t_.prototype.Fa,l=e8.XhrIo=t_}).apply(void 0!==e4?e4:"u">typeof self?self:"u">typeof window?window:{});class e7{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}e7.UNAUTHENTICATED=new e7(null),e7.GOOGLE_CREDENTIALS=new e7("google-credentials-uid"),e7.FIRST_PARTY=new e7("first-party-uid"),e7.MOCK_USER=new e7("mock-user");let e9="12.9.0",te=new en("@firebase/firestore");function tt(){return te.logLevel}function tr(e,...t){if(te.logLevel<=s.DEBUG){let r=t.map(ts);te.debug(`Firestore (${e9}): ${e}`,...r)}}function tn(e,...t){if(te.logLevel<=s.ERROR){let r=t.map(ts);te.error(`Firestore (${e9}): ${e}`,...r)}}function ti(e,...t){if(te.logLevel<=s.WARN){let r=t.map(ts);te.warn(`Firestore (${e9}): ${e}`,...r)}}function ts(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function ta(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,to(e,n,r)}function to(e,t,r){let n=`FIRESTORE (${e9}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw tn(n),Error(n)}function tl(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||to(t,i,n)}let tu={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class th extends j{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class tc{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class td{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(e7.UNAUTHENTICATED))}shutdown(){}}class tp{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class tg{constructor(e){this.t=e,this.currentUser=e7.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){tl(void 0===this.o,42304);let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),i=new tc;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new tc,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{tr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(tr("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new tc)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(tr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(tl("string"==typeof t.accessToken,31837,{l:t}),new td(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return tl(null===e||"string"==typeof e,2055,{h:e}),new e7(e)}}class tm{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=e7.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class ty{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new tm(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(e7.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class tw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class tv{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,eR(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){tl(void 0===this.o,3512);let r=e=>{null!=e.error&&tr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,tr("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{tr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?n(e):tr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new tw(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(tl("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new tw(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class tb{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="u">typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(0);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function tE(e,t){return e<t?-1:+(e>t)}function tI(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return t_(r)===t_(i)?tE(r,i):t_(r)?1:-1}return tE(e.length,t.length)}function t_(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function tT(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}let tS="__name__";class tx{constructor(e,t,r){void 0===t?t=0:t>e.length&&ta(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&ta(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===tx.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof tx?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=tx.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return tE(e.length,t.length)}static compareSegments(e,t){let r=tx.isNumericId(e),n=tx.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?tx.extractNumericId(e).compare(tx.extractNumericId(t)):tI(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return a.fromString(e.substring(4,e.length-2))}}class tC extends tx{construct(e,t,r){return new tC(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new th(tu.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new tC(t)}static emptyPath(){return new tC([])}}let tA=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class tD extends tx{construct(e,t,r){return new tD(e,t,r)}static isValidIdentifier(e){return tA.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),tD.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===tS}static keyField(){return new tD([tS])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new th(tu.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new th(tu.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new th(tu.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new th(tu.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new tD(t)}static emptyPath(){return new tD([])}}class tN{constructor(e){this.path=e}static fromPath(e){return new tN(tC.fromString(e))}static fromName(e){return new tN(tC.fromString(e).popFirst(5))}static empty(){return new tN(tC.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===tC.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return tC.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new tN(new tC(e.slice()))}}function tk(e,t,r){if(!r)throw new th(tu.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function tR(e){if(!tN.isDocumentKey(e))throw new th(tu.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function tO(e){if(tN.isDocumentKey(e))throw new th(tu.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function tM(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function tL(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":ta(12329,{type:typeof e})}function tP(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new th(tu.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=tL(e);throw new th(tu.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function tF(e,t){if(t<=0)throw new th(tu.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function tV(e,t){let r={typeString:e};return t&&(r.value=t),r}function tB(e,t){let r;if(!tM(e))throw new th(tu.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new th(tu.INVALID_ARGUMENT,r);return!0}class tU{static now(){return tU.fromMillis(Date.now())}static fromDate(e){return tU.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new tU(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new th(tu.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new th(tu.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?tE(this.nanoseconds,e.nanoseconds):tE(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:tU._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(tB(e,tU._jsonSchema))return new tU(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}tU._jsonSchemaVersion="firestore/timestamp/1.0",tU._jsonSchema={type:tV("string",tU._jsonSchemaVersion),seconds:tV("number"),nanoseconds:tV("number")};class tq{static fromTimestamp(e){return new tq(e)}static min(){return new tq(new tU(0,0))}static max(){return new tq(new tU(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class tj{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function tz(e){return e.fields.find(e=>2===e.kind)}function t$(e){return e.fields.filter(e=>2!==e.kind)}function tG(e,t){let r=tE(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=function(e,t){let r=tD.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:tE(e.kind,t.kind)}(e.fields[n],t.fields[n])))return r;return tE(e.fields.length,t.fields.length)}tj.UNKNOWN_ID=-1;class tK{constructor(e,t){this.fieldPath=e,this.kind=t}}class tH{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new tH(0,tJ.min())}}function tQ(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new tJ(tq.fromTimestamp(1e9===n?new tU(r+1,0):new tU(r,n)),tN.empty(),t)}function tW(e){return new tJ(e.readTime,e.key,-1)}class tJ{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new tJ(tq.min(),tN.empty(),-1)}static max(){return new tJ(tq.max(),tN.empty(),-1)}}function tY(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=tN.comparator(e.documentKey,t.documentKey))?r:tE(e.largestBatchId,t.largestBatchId)}let tX="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class tZ{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function t0(e){if(e.code!==tu.FAILED_PRECONDITION||e.message!==tX)throw e;tr("LocalStore","Unexpectedly lost primary lease")}class t1{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ta(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new t1((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof t1?t:t1.resolve(t)}catch(e){return t1.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):t1.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):t1.reject(t)}static resolve(e){return new t1((t,r)=>{t(e)})}static reject(e){return new t1((t,r)=>{r(e)})}static waitFor(e){return new t1((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=t1.resolve(!1);for(let r of e)t=t.next(e=>e?t1.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new t1((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new t1((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let t2="SimpleDb";class t6{static open(e,t,r,n){try{return new t6(t,e.transaction(n,r))}catch(e){throw new t8(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new tc,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new t8(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let r=rr(t.target.error);this.S.reject(new t8(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(tr(t2,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new t9(this.transaction.objectStore(e))}}class t3{static delete(e){return tr(t2,"Removing database:",e),re(A().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!q())return!1;if(t3.F())return!0;let e=P(),t=t3.M(e),r=t5(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<r&&r<4.5)}static F(){return void 0!==b.default&&"YES"===b.default.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,12.2===t3.M(P())&&tn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(tr(t2,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new t8(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new th(tu.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new th(tu.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new t8(e,n))},n.onupgradeneeded=e=>{tr(t2,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,n.transaction,e.oldVersion,this.version).next(()=>{tr(t2,"Database upgrade to version "+this.version+" complete")})}})),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=t6.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),t1.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(tr(t2,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function t5(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class t4{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return re(this.U.delete())}}class t8 extends th{constructor(e,t){super(tu.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function t7(e){return"IndexedDbTransactionError"===e.name}class t9{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(tr(t2,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(tr(t2,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),re(r)}add(e){return tr(t2,"ADD",this.store.name,e,e),re(this.store.add(e))}get(e){return re(this.store.get(e)).next(t=>(void 0===t&&(t=null),tr(t2,"GET",this.store.name,e,t),t))}delete(e){return tr(t2,"DELETE",this.store.name,e),re(this.store.delete(e))}count(){return tr(t2,"COUNT",this.store.name),re(this.store.count())}H(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new t1((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.J(e,(e,r)=>{t.push(r)}).next(()=>t)}}Z(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new t1((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}X(e,t){tr(t2,"DELETE ALL",this.store.name);let r=this.options(e,t);r.Y=!1;let n=this.cursor(r);return this.J(n,(e,t,r)=>r.delete())}ee(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.J(n,t)}te(e){let t=this.cursor({});return new t1((r,n)=>{t.onerror=e=>{n(rr(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}J(e,t){let r=[];return new t1((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new t4(i),a=t(i.primaryKey,i.value,s);if(a instanceof t1){let e=a.catch(e=>(s.done(),t1.reject(e)));r.push(e)}s.isDone?n():null===s.G?i.continue():i.continue(s.G)}}).next(()=>t1.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function re(e){return new t1((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(rr(e.target.error))}})}let rt=!1;function rr(e){let t=t3.M(P());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new th("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return rt||(rt=!0,setTimeout(()=>{throw e},0)),e}}return e}let rn="IndexBackfiller";class ri{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){tr(rn,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();tr(rn,`Documents written: ${e}`)}catch(e){t7(e)?tr(rn,"Ignoring IndexedDB error during index backfill: ",e):await t0(e)}await this.re(6e4)})}}class rs{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let r=new Set,n=t,i=!0;return t1.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return tr(rn,`Processing collection: ${t}`),this.oe(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(n,r)).next(r=>(tr(rn,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}_e(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=tW(t);tY(n,r)>0&&(r=n)}),new tJ(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ra{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}function ro(e){return null==e}function rl(e){return 0===e&&1/e==-1/0}function ru(e){return"number"==typeof e&&Number.isInteger(e)&&!rl(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function rh(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"}ra.ce=-1;function rc(e){let t=e.length;if(tl(t>=2,64408,{path:e}),2===t)return tl("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),tC.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>r)&&ta(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:ta(61167,{path:e})}s=t+2}return new tC(n)}let rd="remoteDocuments",rf="owner",rp="owner",rg="mutationQueues",rm="mutations",ry="batchId",rw="userMutationsIndex",rv=["userId","batchId"],rb={},rE="documentMutations",rI="remoteDocumentsV14",r_=["prefixPath","collectionGroup","readTime","documentId"],rT="documentKeyIndex",rS=["prefixPath","collectionGroup","documentId"],rx="collectionGroupIndex",rC=["collectionGroup","readTime","prefixPath","documentId"],rA="remoteDocumentGlobal",rD="remoteDocumentGlobalKey",rN="targets",rk="queryTargetsIndex",rR=["canonicalId","targetId"],rO="targetDocuments",rM=["targetId","path"],rL="documentTargetsIndex",rP=["path","targetId"],rF="targetGlobalKey",rV="targetGlobal",rB="collectionParents",rU=["collectionId","parent"],rq="clientMetadata",rj="bundles",rz="namedQueries",r$="indexConfiguration",rG="collectionGroupIndex",rK="indexState",rH=["indexId","uid"],rQ="sequenceNumberIndex",rW=["uid","sequenceNumber"],rJ="indexEntries",rY=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],rX="documentKeyIndex",rZ=["indexId","uid","orderedDocumentKey"],r0="documentOverlays",r1=["userId","collectionPath","documentId"],r2="collectionPathOverlayIndex",r6=["userId","collectionPath","largestBatchId"],r3="collectionGroupOverlayIndex",r5=["userId","collectionGroup","largestBatchId"],r4="globals",r8=[rg,rm,rE,rd,rN,rf,rV,rO,rq,rA,rB,rj,rz],r7=[...r8,r0],r9=[rg,rm,rE,rI,rN,rf,rV,rO,rq,rA,rB,rj,rz,r0],ne=[...r9,r$,rK,rJ],nt=[...ne,r4];class nr extends tZ{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function nn(e,t){return t3.O(e.le,t)}function ni(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function ns(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function na(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class no{constructor(e,t){this.comparator=e,this.root=t||nu.EMPTY}insert(e,t){return new no(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nu.BLACK,null,null))}remove(e){return new no(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nu.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nl(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nl(this.root,e,this.comparator,!1)}getReverseIterator(){return new nl(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nl(this.root,e,this.comparator,!0)}}class nl{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nu{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:nu.RED,this.left=null!=n?n:nu.EMPTY,this.right=null!=i?i:nu.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new nu(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return nu.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return nu.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,nu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,nu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ta(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ta(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw ta(27949);return e+ +!this.isRed()}}nu.EMPTY=null,nu.RED=!0,nu.BLACK=!1,nu.EMPTY=new class{constructor(){this.size=0}get key(){throw ta(57766)}get value(){throw ta(16141)}get color(){throw ta(16727)}get left(){throw ta(29726)}get right(){throw ta(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new nu(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class nh{constructor(e){this.comparator=e,this.data=new no(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new nc(this.data.getIterator())}getIteratorFrom(e){return new nc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof nh)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new nh(this.comparator);return t.data=e,t}}class nc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function nd(e){return e.hasNext()?e.getNext():void 0}class nf{constructor(e){this.fields=e,e.sort(tD.comparator)}static empty(){return new nf([])}unionWith(e){let t=new nh(tD.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new nf(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return tT(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class np extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ng{constructor(e){this.binaryString=e}static fromBase64String(e){return new ng(function(e){try{return atob(e)}catch(e){throw"u">typeof DOMException&&e instanceof DOMException?new np("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new ng(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return tE(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ng.EMPTY_BYTE_STRING=new ng("");let nm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ny(e){if(tl(!!e,39018),"string"==typeof e){let t=0,r=nm.exec(e);if(tl(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:nw(e.seconds),nanos:nw(e.nanos)}}function nw(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function nv(e){return"string"==typeof e?ng.fromBase64String(e):ng.fromUint8Array(e)}let nb="server_timestamp",nE="__type__",nI="__previous_value__",n_="__local_write_time__";function nT(e){return(e?.mapValue?.fields||{})[nE]?.stringValue===nb}function nS(e){let t=e.mapValue.fields[nI];return nT(t)?nS(t):t}function nx(e){let t=ny(e.mapValue.fields[n_].timestampValue);return new tU(t.seconds,t.nanos)}class nC{constructor(e,t,r,n,i,s,a,o,l,u,h){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u,this.apiKey=h}}let nA="(default)";class nD{constructor(e,t){this.projectId=e,this.database=t||nA}static empty(){return new nD("","")}get isDefaultDatabase(){return this.database===nA}isEqual(e){return e instanceof nD&&e.projectId===this.projectId&&e.database===this.database}}let nN="__type__",nk="__max__",nR={mapValue:{fields:{__type__:{stringValue:nk}}}},nO="__vector__",nM="value",nL={nullValue:"NULL_VALUE"};function nP(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?nT(e)?4:nY(e)?0x1fffffffffffff:nW(e)?10:11:ta(28295,{value:e})}function nF(e,t){if(e===t)return!0;let r=nP(e);if(r!==nP(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return nx(e).isEqual(nx(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=ny(e.timestampValue),i=ny(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return nv(e.bytesValue).isEqual(nv(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return nw(e.geoPointValue.latitude)===nw(t.geoPointValue.latitude)&&nw(e.geoPointValue.longitude)===nw(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return nw(e.integerValue)===nw(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=nw(e.doubleValue),n=nw(t.doubleValue);return r===n?rl(r)===rl(n):isNaN(r)&&isNaN(n)}return!1;case 9:return tT(e.arrayValue.values||[],t.arrayValue.values||[],nF);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(ni(s)!==ni(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!nF(s[e],a[e])))return!1;return!0;default:return ta(52216,{left:e})}}function nV(e,t){return void 0!==(e.values||[]).find(e=>nF(e,t))}function nB(e,t){var r,n,i,s,a,o;if(e===t)return 0;let l=nP(e),u=nP(t);if(l!==u)return tE(l,u);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return tE(e.booleanValue,t.booleanValue);case 2:let h,c;return h=nw(e.integerValue||e.doubleValue),h<(c=nw(t.integerValue||t.doubleValue))?-1:h>c?1:h===c?0:isNaN(h)?isNaN(c)?0:-1:1;case 3:return nU(e.timestampValue,t.timestampValue);case 4:return nU(nx(e),nx(t));case 5:return tI(e.stringValue,t.stringValue);case 6:let d,f;return r=e.bytesValue,n=t.bytesValue,d=nv(r),f=nv(n),d.compareTo(f);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=tE(r[e],n[e]);if(0!==t)return t}return tE(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:let p;return i=e.geoPointValue,s=t.geoPointValue,0!==(p=tE(nw(i.latitude),nw(s.latitude)))?p:tE(nw(i.longitude),nw(s.longitude));case 9:return nq(e.arrayValue,t.arrayValue);case 10:let g,m,y,w,v;return a=e.mapValue,o=t.mapValue,g=a.fields||{},m=o.fields||{},y=g[nM]?.arrayValue,w=m[nM]?.arrayValue,0!==(v=tE(y?.values?.length||0,w?.values?.length||0))?v:nq(y,w);case 11:return function(e,t){if(e===nR.mapValue&&t===nR.mapValue)return 0;if(e===nR.mapValue)return 1;if(t===nR.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=tI(n[e],s[e]);if(0!==t)return t;let a=nB(r[n[e]],i[s[e]]);if(0!==a)return a}return tE(n.length,s.length)}(e.mapValue,t.mapValue);default:throw ta(23264,{he:l})}}function nU(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return tE(e,t);let r=ny(e),n=ny(t),i=tE(r.seconds,n.seconds);return 0!==i?i:tE(r.nanos,n.nanos)}function nq(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=nB(r[e],n[e]);if(t)return t}return tE(r.length,n.length)}function nj(e){var t,r;let n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(n=ny(e.timestampValue),`time(${n.seconds},${n.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?nv(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,tN.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=nj(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${nj(e.fields[i])}`;return r+"}"}(e.mapValue):ta(61005,{value:e})}function nz(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function n$(e){return!!e&&"integerValue"in e}function nG(e){return!!e&&"arrayValue"in e}function nK(e){return!!e&&"nullValue"in e}function nH(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function nQ(e){return!!e&&"mapValue"in e}function nW(e){return(e?.mapValue?.fields||{})[nN]?.stringValue===nO}function nJ(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return ns(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=nJ(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=nJ(e.arrayValue.values[r]);return t}return{...e}}function nY(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===nk}let nX={mapValue:{fields:{[nN]:{stringValue:nO},[nM]:{arrayValue:{}}}}};function nZ(e,t){let r=nB(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function n0(e,t){let r=nB(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class n1{constructor(e){this.value=e}static empty(){return new n1({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!nQ(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=nJ(t)}setAll(e){let t=tD.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=nJ(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());nQ(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return nF(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];nQ(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(ns(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new n1(nJ(this.value))}}class n2{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new n2(e,0,tq.min(),tq.min(),tq.min(),n1.empty(),0)}static newFoundDocument(e,t,r,n){return new n2(e,1,t,tq.min(),r,n,0)}static newNoDocument(e,t){return new n2(e,2,t,tq.min(),tq.min(),n1.empty(),0)}static newUnknownDocument(e,t){return new n2(e,3,t,tq.min(),tq.min(),n1.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(tq.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=n1.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=n1.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=tq.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof n2&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n2(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class n6{constructor(e,t){this.position=e,this.inclusive=t}}function n3(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?tN.comparator(tN.fromName(a.referenceValue),r.key):nB(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function n5(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!nF(e.position[r],t.position[r]))return!1;return!0}class n4{constructor(e,t="asc"){this.field=e,this.dir=t}}class n8{}class n7 extends n8{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new ia(e,t,r):"array-contains"===t?new ih(e,r):"in"===t?new ic(e,r):"not-in"===t?new id(e,r):"array-contains-any"===t?new ip(e,r):new n7(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new io(e,r):new il(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(nB(t,this.value)):null!==t&&nP(this.value)===nP(t)&&this.matchesComparison(nB(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ta(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class n9 extends n8{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new n9(e,t)}matches(e){return ie(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ie(e){return"and"===e.op}function it(e){return"or"===e.op}function ir(e){return ii(e)&&ie(e)}function ii(e){for(let t of e.filters)if(t instanceof n9)return!1;return!0}function is(e,t){let r=e.filters.concat(t);return n9.create(r,e.op)}class ia extends n7{constructor(e,t,r){super(e,t,r),this.key=tN.fromName(r.referenceValue)}matches(e){let t=tN.comparator(e.key,this.key);return this.matchesComparison(t)}}class io extends n7{constructor(e,t){super(e,"in",t),this.keys=iu("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class il extends n7{constructor(e,t){super(e,"not-in",t),this.keys=iu("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function iu(e,t){return(t.arrayValue?.values||[]).map(e=>tN.fromName(e.referenceValue))}class ih extends n7{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return nG(t)&&nV(t.arrayValue,this.value)}}class ic extends n7{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&nV(this.value.arrayValue,t)}}class id extends n7{constructor(e,t){super(e,"not-in",t)}matches(e){if(nV(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!nV(this.value.arrayValue,t)}}class ip extends n7{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!nG(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>nV(this.value.arrayValue,e))}}class ig{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function im(e,t=null,r=[],n=[],i=null,s=null,a=null){return new ig(e,t,r,n,i,s,a)}function iy(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof n7)return t.field.canonicalString()+t.op.toString()+nj(t.value);if(ir(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),ro(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>nj(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>nj(e)).join(",")),e.Te=t}return e.Te}function iw(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var r,n;if(r=e.orderBy[i],n=t.orderBy[i],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof n7?r instanceof n7&&t.op===r.op&&t.field.isEqual(r.field)&&nF(t.value,r.value):t instanceof n9?r instanceof n9&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,i)=>t&&e(n,r.filters[i]),!0):void ta(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!n5(e.startAt,t.startAt)&&n5(e.endAt,t.endAt)}function iv(e){return tN.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function ib(e,t){return e.filters.filter(e=>e instanceof n7&&e.field.isEqual(t))}function iE(e,t,r){let n=nL,i=!0;for(let r of ib(e,t)){let e=nL,t=!0;switch(r.op){case"<":case"<=":var s;e="nullValue"in(s=r.value)?nL:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?nz(nD.empty(),tN.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?nW(s)?nX:{mapValue:{}}:ta(35942,{value:s});break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=nL}0>nZ({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>nZ({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function iI(e,t,r){let n=nR,i=!0;for(let r of ib(e,t)){let e=nR,t=!0;switch(r.op){case">=":case">":var s;e="nullValue"in(s=r.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?nz(nD.empty(),tN.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?nX:"mapValue"in s?nW(s)?{mapValue:{}}:nR:ta(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=nR}n0({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];n0({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}class i_{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function iT(e){return new i_(e)}function iS(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function ix(e){return null!==e.collectionGroup}function iC(e){if(null===e.Ie){let t;e.Ie=[];let r=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new nh(tD.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new n4(t,n))}),r.has(tD.keyField().canonicalString())||e.Ie.push(new n4(tD.keyField(),n))}return e.Ie}function iA(e){return e.Ee||(e.Ee=iD(e,iC(e))),e.Ee}function iD(e,t){if("F"===e.limitType)return im(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new n4(e.field,t)});let r=e.endAt?new n6(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new n6(e.startAt.position,e.startAt.inclusive):null;return im(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function iN(e,t){let r=e.filters.concat([t]);return new i_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function ik(e,t,r){return new i_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function iR(e,t){return iw(iA(e),iA(t))&&e.limitType===t.limitType}function iO(e){return`${iy(iA(e))}|lt:${e.limitType}`}function iM(e){var t;let r;return`Query(target=${r=(t=iA(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof n7?`${t.field.canonicalString()} ${t.op} ${nj(t.value)}`:t instanceof n9?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),ro(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>nj(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>nj(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function iL(e,t){var r,n,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):tN.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let r of iC(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(r=e,n=t,(!r.startAt||(i=r.startAt,o=n3(i,iC(r),n),i.inclusive?!!(o<=0):!!(o<0)))&&(!r.endAt||(s=r.endAt,l=n3(s,iC(r),n),s.inclusive?!!(l>=0):!!(l>0))))}function iP(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function iF(e){return(t,r)=>{let n=!1;for(let i of iC(e)){let e=function(e,t,r){var n;let i,s,a=e.field.isKeyField()?tN.comparator(t.key,r.key):(n=e.field,i=t.data.field(n),s=r.data.field(n),null!==i&&null!==s?nB(i,s):ta(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return ta(19790,{direction:e.dir})}}(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class iV{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){ns(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return na(this.inner)}size(){return this.innerSize}}let iB=new no(tN.comparator),iU=new no(tN.comparator);function iq(...e){let t=iU;for(let r of e)t=t.insert(r.key,r);return t}function ij(e){let t=iU;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function iz(){return new iV(e=>e.toString(),(e,t)=>e.isEqual(t))}let i$=new no(tN.comparator),iG=new nh(tN.comparator);function iK(...e){let t=iG;for(let r of e)t=t.add(r);return t}let iH=new nh(tE);function iQ(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rl(t)?"-0":t}}function iW(e){return{integerValue:""+e}}class iJ{constructor(){this._=void 0}}function iY(e,t){return e instanceof i6?n$(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class iX extends iJ{}class iZ extends iJ{constructor(e){super(),this.elements=e}}function i0(e,t){let r=i5(t);for(let t of e.elements)r.some(e=>nF(e,t))||r.push(t);return{arrayValue:{values:r}}}class i1 extends iJ{constructor(e){super(),this.elements=e}}function i2(e,t){let r=i5(t);for(let t of e.elements)r=r.filter(e=>!nF(e,t));return{arrayValue:{values:r}}}class i6 extends iJ{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function i3(e){return nw(e.integerValue||e.doubleValue)}function i5(e){return nG(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class i4{constructor(e,t){this.field=e,this.transform=t}}class i8{constructor(e,t){this.version=e,this.transformResults=t}}class i7{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new i7}static exists(e){return new i7(void 0,e)}static updateTime(e){return new i7(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function i9(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class se{}function st(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new su(e.key,i7.none()):new si(e.key,e.data,i7.none());{let r=e.data,n=n1.empty(),i=new nh(tD.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new ss(e.key,n,new nf(i.toArray()),i7.none())}}function sr(e,t,r,n){return e instanceof si?function(e,t,r,n){if(!i9(e.precondition,t))return r;let i=e.value.clone(),s=sl(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof ss?function(e,t,r,n){if(!i9(e.precondition,t))return r;let i=sl(e.fieldTransforms,n,t),s=t.data;return(s.setAll(sa(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):i9(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function sn(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&tT(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof iZ&&n instanceof iZ||r instanceof i1&&n instanceof i1?tT(r.elements,n.elements,nF):r instanceof i6&&n instanceof i6?nF(r.Ae,n.Ae):r instanceof iX&&n instanceof iX)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class si extends se{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class ss extends se{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function sa(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function so(e,t,r){let n=new Map;tl(e.length===r.length,32656,{Ve:r.length,de:e.length});for(let s=0;s<r.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);n.set(a.field,(i=r[s],o instanceof iZ?i0(o,l):o instanceof i1?i2(o,l):i))}return n}function sl(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,function(e,t,r){var n;let i,s,a;return e instanceof iX?(n=t,i={fields:{[nE]:{stringValue:nb},[n_]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}},n&&nT(n)&&(n=nS(n)),n&&(i.fields[nI]=n),{mapValue:i}):e instanceof iZ?i0(e,t):e instanceof i1?i2(e,t):(a=i3(s=iY(e,t))+i3(e.Ae),n$(s)&&n$(e.Ae)?iW(a):iQ(e.serializer,a))}(e,s,t))}return n}class su extends se{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class sh extends se{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class sc{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&function(e,t,r){let n,i;e instanceof si?(n=e.value.clone(),i=so(e.fieldTransforms,t,r.transformResults),n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()):e instanceof ss?function(e,t,r){if(!i9(e.precondition,t))return t.convertToUnknownDocument(r.version);let n=so(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(sa(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=sr(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=sr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=iz();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=st(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(tq.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),iK())}isEqual(e){return this.batchId===e.batchId&&tT(this.mutations,e.mutations,(e,t)=>sn(e,t))&&tT(this.baseMutations,e.baseMutations,(e,t)=>sn(e,t))}}class sd{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){tl(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let n=i$,i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new sd(e,t,r,n)}}class sf{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class sp{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class sg{constructor(e,t){this.count=e,this.unchangedNames=t}}function sm(e){switch(e){case tu.OK:return ta(64938);case tu.CANCELLED:case tu.UNKNOWN:case tu.DEADLINE_EXCEEDED:case tu.RESOURCE_EXHAUSTED:case tu.INTERNAL:case tu.UNAVAILABLE:case tu.UNAUTHENTICATED:return!1;case tu.INVALID_ARGUMENT:case tu.NOT_FOUND:case tu.ALREADY_EXISTS:case tu.PERMISSION_DENIED:case tu.FAILED_PRECONDITION:case tu.ABORTED:case tu.OUT_OF_RANGE:case tu.UNIMPLEMENTED:case tu.DATA_LOSS:return!0;default:return ta(15467,{code:e})}}function sy(e){if(void 0===e)return tn("GRPC error has no .code"),tu.UNKNOWN;switch(e){case m.OK:return tu.OK;case m.CANCELLED:return tu.CANCELLED;case m.UNKNOWN:return tu.UNKNOWN;case m.DEADLINE_EXCEEDED:return tu.DEADLINE_EXCEEDED;case m.RESOURCE_EXHAUSTED:return tu.RESOURCE_EXHAUSTED;case m.INTERNAL:return tu.INTERNAL;case m.UNAVAILABLE:return tu.UNAVAILABLE;case m.UNAUTHENTICATED:return tu.UNAUTHENTICATED;case m.INVALID_ARGUMENT:return tu.INVALID_ARGUMENT;case m.NOT_FOUND:return tu.NOT_FOUND;case m.ALREADY_EXISTS:return tu.ALREADY_EXISTS;case m.PERMISSION_DENIED:return tu.PERMISSION_DENIED;case m.FAILED_PRECONDITION:return tu.FAILED_PRECONDITION;case m.ABORTED:return tu.ABORTED;case m.OUT_OF_RANGE:return tu.OUT_OF_RANGE;case m.UNIMPLEMENTED:return tu.UNIMPLEMENTED;case m.DATA_LOSS:return tu.DATA_LOSS;default:return ta(39323,{code:e})}}(y=m||(m={}))[y.OK=0]="OK",y[y.CANCELLED=1]="CANCELLED",y[y.UNKNOWN=2]="UNKNOWN",y[y.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",y[y.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",y[y.NOT_FOUND=5]="NOT_FOUND",y[y.ALREADY_EXISTS=6]="ALREADY_EXISTS",y[y.PERMISSION_DENIED=7]="PERMISSION_DENIED",y[y.UNAUTHENTICATED=16]="UNAUTHENTICATED",y[y.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",y[y.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",y[y.ABORTED=10]="ABORTED",y[y.OUT_OF_RANGE=11]="OUT_OF_RANGE",y[y.UNIMPLEMENTED=12]="UNIMPLEMENTED",y[y.INTERNAL=13]="INTERNAL",y[y.UNAVAILABLE=14]="UNAVAILABLE",y[y.DATA_LOSS=15]="DATA_LOSS";let sw=null;function sv(){return new TextEncoder}let sb=new a([0xffffffff,0xffffffff],0);function sE(e){let t=sv().encode(e),r=new o;return r.update(t),new Uint8Array(r.digest())}function sI(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new a([r,n],0),new a([i,s],0)]}class s_{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new sT(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new sT(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new sT(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=a.fromNumber(this.ge)}ye(e,t,r){let n=e.add(t.multiply(a.fromNumber(r)));return 1===n.compare(sb)&&(n=new a([n.getBits(0),n.getBits(1)],0)),n.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,r]=sI(sE(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);if(!this.we(n))return!1}return!0}static create(e,t,r){let n=new s_(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.ge)return;let[t,r]=sI(sE(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);this.be(n)}}be(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class sT extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class sS{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,sx.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new sS(tq.min(),n,new no(tE),iB,iK())}}class sx{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new sx(r,t,iK(),iK(),iK())}}class sC{constructor(e,t,r,n){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=n}}class sA{constructor(e,t){this.targetId=e,this.Ce=t}}class sD{constructor(e,t,r=ng.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class sN{constructor(){this.ve=0,this.Fe=sO(),this.Me=ng.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=iK(),t=iK(),r=iK();return this.Fe.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:ta(38017,{changeType:i})}}),new sx(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=sO()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,tl(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class sk{constructor(e){this.Ge=e,this.ze=new Map,this.je=iB,this.He=sR(),this.Je=sR(),this.Ze=new no(tE)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:ta(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,r)=>{this.rt(r)&&t(r)})}st(e){let t=e.targetId,r=e.Ce.count,n=this.ot(t);if(n){let a=n.target;if(iv(a))if(0===r){let e=new tN(a.path);this.et(t,e,n2.newNoDocument(e,tq.min()))}else tl(1===r,20013,{expectedCount:r});else{let n=this._t(t);if(n!==r){var i,s;let r,a,o=this.ut(e),l=o?this.ct(o,e,n):1;0!==l&&(this.it(t),this.Ze=this.Ze.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),sw?.lt((i=e.Ce,s=this.Ge.ht(),r={localCacheCount:n,existenceFilterCount:i.count,databaseId:s.database,projectId:s.projectId},(a=i.unchangedNames)&&(r.bloomFilter={applied:0===l,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>o?.mightContain(e)??!1}),r))}}}}ut(e){let t,r,n=e.Ce.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=nv(i).toUint8Array()}catch(e){if(e instanceof np)return ti("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new s_(t,s,a)}catch(e){return ti(e instanceof sT?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.ge?null:r}ct(e,t,r){return 2*(t.Ce.count!==r-this.Pt(e,t.targetId))}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;e.mightContain(s)||(this.et(t,r,null),n++)}),n}Tt(e){let t=new Map;this.ze.forEach((r,n)=>{let i=this.ot(n);if(i){if(r.current&&iv(i.target)){let t=new tN(i.target.path);this.It(t).has(n)||this.Et(n,t)||this.et(n,t,n2.newNoDocument(t,e))}r.Be&&(t.set(n,r.ke()),r.Ke())}});let r=iK();this.Je.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.je.forEach((t,r)=>r.setReadTime(e));let n=new sS(e,t,this.Ze,this.je,r);return this.je=iB,this.He=sR(),this.Je=sR(),this.Ze=new no(tE),n}Ye(e,t){if(!this.rt(e))return;let r=2*!!this.Et(e,t.key);this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let n=this.nt(e);this.Et(e,t)?n.qe(t,1):n.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new sN,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new nh(tE),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new nh(tE),this.He=this.He.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||tr("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new sN),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function sR(){return new no(tN.comparator)}function sO(){return new no(tN.comparator)}let sM={asc:"ASCENDING",desc:"DESCENDING"},sL={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},sP={and:"AND",or:"OR"};class sF{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function sV(e,t){return e.useProto3Json||ro(t)?t:{value:t}}function sB(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function sU(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function sq(e){let t;return tl(!!e,49232),tq.fromTimestamp(new tU((t=ny(e)).seconds,t.nanos))}function sj(e,t){return sz(e,t).canonicalString()}function sz(e,t){let r=new tC(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function s$(e){let t=tC.fromString(e);return tl(s4(t),10190,{key:t.toString()}),t}function sG(e,t){return sj(e.databaseId,t.path)}function sK(e,t){let r=s$(t);if(r.get(1)!==e.databaseId.projectId)throw new th(tu.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new th(tu.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new tN(sJ(r))}function sH(e,t){return sj(e.databaseId,t)}function sQ(e){let t=s$(e);return 4===t.length?tC.emptyPath():sJ(t)}function sW(e){return new tC(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function sJ(e){return tl(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function sY(e,t,r){return{name:sG(e,t),fields:r.value.mapValue.fields}}function sX(e,t,r){let n=sK(e,t.name),i=sq(t.updateTime),s=t.createTime?sq(t.createTime):tq.min(),a=new n1({mapValue:{fields:t.fields}}),o=n2.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function sZ(e,t){var r,n;let i;if(t instanceof si)i={update:sY(e,t.key,t.value)};else if(t instanceof su)i={delete:sG(e,t.key)};else if(t instanceof ss){let r;i={update:sY(e,t.key,t.data),updateMask:(n=t.fieldMask,r=[],n.fields.forEach(e=>r.push(e.canonicalString())),{fieldPaths:r})}}else{if(!(t instanceof sh))return ta(16599,{dt:t.type});i={verify:sG(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof iX)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof iZ)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof i1)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof i6)return{fieldPath:t.field.canonicalString(),increment:r.Ae};throw ta(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:sB(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:ta(27497)),i}function s0(e,t){var r;let n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?i7.updateTime(sq(r.updateTime)):void 0!==r.exists?i7.exists(r.exists):i7.none():i7.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let r;return r=null,"setToServerValue"in t?(tl("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new iX):"appendMissingElements"in t?r=new iZ(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new i1(t.removeAllFromArray.values||[]):"increment"in t?r=new i6(e,t.increment):ta(16584,{proto:t}),new i4(tD.fromServerFormat(t.fieldPath),r)}):[];if(t.update){t.update.name;let r=sK(e,t.update.name),s=new n1({mapValue:{fields:t.update.fields}});return t.updateMask?new ss(r,s,new nf((t.updateMask.fieldPaths||[]).map(e=>tD.fromServerFormat(e))),n,i):new si(r,s,n,i)}return t.delete?new su(sK(e,t.delete),n):t.verify?new sh(sK(e,t.verify),n):ta(1463,{proto:t})}function s1(e,t){return{documents:[sH(e,t.path)]}}function s2(e,t){var r,n;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=sH(e,i);let o=function(e){if(0!==e.length)return function e(t){var r;let n;return t instanceof n7?function(e){if("=="===e.op){if(nH(e.value))return{unaryFilter:{field:s3(e.field),op:"IS_NAN"}};if(nK(e.value))return{unaryFilter:{field:s3(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(nH(e.value))return{unaryFilter:{field:s3(e.field),op:"IS_NOT_NAN"}};if(nK(e.value))return{unaryFilter:{field:s3(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:s3(e.field),op:sL[e.op],value:e.value}}}(t):t instanceof n9?1===(n=(r=t).getFilters().map(t=>e(t))).length?n[0]:{compositeFilter:{op:sP[r.op],filters:n}}:ta(54877,{filter:t})}(n9.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:s3(e.field),direction:sM[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=sV(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(r=t.startAt).inclusive,values:r.position}),t.endAt&&(s.structuredQuery.endAt={before:!(n=t.endAt).inclusive,values:n.position}),{ft:s,parent:i}}function s6(e){var t,r,n;let i,s,a,o,l=sQ(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){tl(1===h,65062);let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=s5(e.unaryFilter.field);return n7.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=s5(e.unaryFilter.field);return n7.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=s5(e.unaryFilter.field);return n7.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=s5(e.unaryFilter.field);return n7.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ta(61313);default:return ta(60726)}}(t):void 0!==t.fieldFilter?n7.create(s5(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ta(58110);default:return ta(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?n9.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return ta(1026)}}(t.compositeFilter.op)):ta(30097,{filter:t})}(u.where))instanceof n9&&ir(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new n4(s5(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let p=null;u.limit&&(p=ro(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let g=null;u.startAt&&(a=!!(r=u.startAt).before,g=new n6(r.values||[],a));let m=null;return u.endAt&&(o=!(n=u.endAt).before,m=new n6(n.values||[],o)),new i_(l,c,f,d,p,"F",g,m)}function s3(e){return{fieldPath:e.canonicalString()}}function s5(e){return tD.fromServerFormat(e.fieldPath)}function s4(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function s8(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class s7{constructor(e,t,r,n,i=tq.min(),s=tq.min(),a=ng.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new s7(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new s7(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new s7(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new s7(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class s9{constructor(e){this.yt=e}}function ae(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:at(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;n.document={name:sG(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:sB(i,t.version.toTimestamp()),createTime:sB(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:ar(t.version)};else{if(!t.isUnknownDocument())return ta(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:ar(t.version)}}return n}function at(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function ar(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function an(e){let t=new tU(e.seconds,e.nanoseconds);return tq.fromTimestamp(t)}function ai(e,t){let r=(t.baseMutations||[]).map(t=>s0(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>s0(e.yt,t)),i=tU.fromMillis(t.localWriteTimeMs);return new sc(t.batchId,i,r,n)}function as(e){var t;let r,n=an(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?an(e.lastLimboFreeSnapshotVersion):tq.min();return new s7(void 0!==e.query.documents?(tl(1===(r=(t=e.query).documents.length),1966,{count:r}),iA(iT(sQ(t.documents[0])))):iA(s6(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,i,ng.fromBase64String(e.resumeToken))}function aa(e,t){let r,n=ar(t.snapshotVersion),i=ar(t.lastLimboFreeSnapshotVersion);r=iv(t.target)?s1(e.yt,t.target):s2(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:iy(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function ao(e){let t=s6({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?ik(t,t.limit,"L"):t}function al(e,t){return new sf(t.largestBatchId,s0(e.yt,t.overlayMutation))}function au(e,t){let r=t.path.lastSegment();return[e,rh(t.path.popLast()),r]}function ah(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:ar(n.readTime),documentKey:rh(n.documentKey.path),largestBatchId:n.largestBatchId}}class ac{getBundleMetadata(e,t){return nn(e,rj).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:an(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return nn(e,rj).put({bundleId:t.id,createTime:ar(sq(t.createTime)),version:t.version})}getNamedQuery(e,t){return nn(e,rz).get(t).next(e=>{if(e)return{name:e.name,query:ao(e.bundledQuery),readTime:an(e.readTime)}})}saveNamedQuery(e,t){return nn(e,rz).put({name:t.name,readTime:ar(sq(t.readTime)),bundledQuery:t.bundledQuery})}}class ad{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new ad(e,t.uid||"")}getOverlay(e,t){return nn(e,r0).get(au(this.userId,t)).next(e=>e?al(this.serializer,e):null)}getOverlays(e,t){let r=iz();return t1.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new sf(t,i);n.push(this.bt(e,s))}),t1.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(rh(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(nn(e,r0).X(r2,n))}),t1.waitFor(i)}getOverlaysForCollection(e,t,r){let n=iz(),i=rh(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,1/0],!0);return nn(e,r0).H(r2,s).next(e=>{for(let t of e){let e=al(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=iz(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return nn(e,r0).ee({index:r3,range:a},(e,t,r)=>{let a=al(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}bt(e,t){return nn(e,r0).put(function(e,t,r){let[n,i,s]=au(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:sZ(e.yt,r.mutation)}}(this.serializer,this.userId,t))}}class af{St(e){return nn(e,r4)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{let t=e?.value;return t?ng.fromUint8Array(t):ng.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class ap{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(nw(e.integerValue));else if("doubleValue"in e){let r=nw(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),rl(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),"string"==typeof r&&(r=ny(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(nv(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?nY(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):nW(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):ta(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let r=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(r)))this.Ot(e,t),this.Ct(r[e],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let n=r[nM].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(nw(n)),this.Ot(nM,t),this.Ct(r[nM],t)}qt(e,t){let r=e.values||[];for(let e of(this.Ft(t,50),r))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),tN.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function ag(e){return Math.ceil((64-function(e){let t=0;for(let r=0;r<8;++r){let n=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e))/8)}ap.Wt=new ap;class am{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ht(r.value),r=t.next();this.Jt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ht(e);else if(e<2048)this.Ht(960|e>>>6),this.Ht(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Ht(480|e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e);else{let e=t.codePointAt(0);this.Ht(240|e>>>18),this.Ht(128|63&e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e)}}this.Jt()}Yt(e){let t=this.en(e),r=ag(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),r=ag(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t,r=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),n=!!(128&r[0]);r[0]^=n?255:128;for(let e=1;e<r.length;++e)r[e]^=255*!!n;return r}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Ht(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class ay{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class aw{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class av{constructor(){this.cn=new am,this.ascending=new ay(this.cn),this.descending=new aw(this.cn)}seed(e){this.cn.seed(e)}ln(e){return 0===e?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class ab{constructor(e,t,r,n){this.hn=e,this.Pn=t,this.Tn=r,this.In=n}En(){let e=this.In.length,t=0===e||255===this.In[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.In,0),t!==e?r.set([0],this.In.length):++r[r.length-1],new ab(this.hn,this.Pn,this.Tn,r)}Rn(e,t,r){return{indexId:this.hn,uid:e,arrayValue:a_(this.Tn),directionalValue:a_(this.In),orderedDocumentKey:a_(t),documentKey:r.path.toArray()}}An(e,t,r){let n=this.Rn(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function aE(e,t){let r=e.hn-t.hn;return 0!==r||0!==(r=aI(e.Tn,t.Tn))||0!==(r=aI(e.In,t.In))?r:tN.comparator(e.Pn,t.Pn)}function aI(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function a_(e){return U()?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):e}function aT(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)}class aS{constructor(e){for(const t of(this.Vn=new nh((e,t)=>tD.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[],e.filters))t.isInequality()?this.Vn=this.Vn.add(t):this.mn.push(t)}get fn(){return this.Vn.size>1}gn(e){if(tl(e.collectionGroup===this.collectionId,49279),this.fn)return!1;let t=tz(e);if(void 0!==t&&!this.pn(t))return!1;let r=t$(e),n=new Set,i=0,s=0;for(;i<r.length&&this.pn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.Vn.size>0){let e=this.Vn.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.yn(e,t)||!this.wn(this.dn[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.dn.length||!this.wn(this.dn[s++],e))return!1}return!0}bn(){if(this.fn)return null;let e=new nh(tD.comparator),t=[];for(let r of this.mn)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new tK(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new tK(r.field,0))}for(let r of this.dn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new tK(r.field,+("asc"!==r.dir))));return new tj(tj.UNKNOWN_ID,this.collectionId,t,tH.empty())}pn(e){for(let t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function ax(e){return e instanceof n7}function aC(e){return e instanceof n9&&ir(e)}function aA(e){return ax(e)||aC(e)||function(e){if(e instanceof n9&&it(e)){for(let t of e.getFilters())if(!ax(t)&&!aC(t))return!1;return!0}return!1}(e)}function aD(e,t){return tl(e instanceof n7||e instanceof n9,38388),tl(t instanceof n7||t instanceof n9,25473),ak(e instanceof n7?t instanceof n7?n9.create([e,t],"and"):aN(e,t):t instanceof n7?aN(t,e):function(e,t){if(tl(e.filters.length>0&&t.filters.length>0,48005),ie(e)&&ie(t))return is(e,t.getFilters());let r=it(e)?e:t,n=it(e)?t:e,i=r.filters.map(e=>aD(e,n));return n9.create(i,"or")}(e,t))}function aN(e,t){if(ie(t))return is(t,e.getFilters());{let r=t.filters.map(t=>aD(e,t));return n9.create(r,"or")}}function ak(e){if(tl(e instanceof n7||e instanceof n9,11850),e instanceof n7)return e;let t=e.getFilters();if(1===t.length)return ak(t[0]);if(ii(e))return e;let r=t.map(e=>ak(e)),n=[];return r.forEach(t=>{t instanceof n7?n.push(t):t instanceof n9&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length?n[0]:n9.create(n,e.op)}class aR{constructor(){this.Sn=new aO}addToCollectionParentIndex(e,t){return this.Sn.add(t),t1.resolve()}getCollectionParents(e,t){return t1.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return t1.resolve()}deleteFieldIndex(e,t){return t1.resolve()}deleteAllFieldIndexes(e){return t1.resolve()}createTargetIndexes(e,t){return t1.resolve()}getDocumentsMatchingTarget(e,t){return t1.resolve(null)}getIndexType(e,t){return t1.resolve(0)}getFieldIndexes(e,t){return t1.resolve([])}getNextCollectionGroupToUpdate(e){return t1.resolve(null)}getMinOffset(e,t){return t1.resolve(tJ.min())}getMinOffsetFromCollectionGroup(e,t){return t1.resolve(tJ.min())}updateCollectionGroup(e,t,r){return t1.resolve()}updateIndexEntries(e,t){return t1.resolve()}}class aO{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new nh(tC.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new nh(tC.comparator)).toArray()}}let aM="IndexedDbIndexManager",aL=new Uint8Array(0);class aP{constructor(e,t){this.databaseId=t,this.Dn=new aO,this.Cn=new iV(e=>iy(e),(e,t)=>iw(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.Dn.add(t)});let i={collectionId:r,parent:rh(n)};return nn(e,rB).put(i)}return t1.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return nn(e,rB).H(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(rc(n.parent))}return r})}addFieldIndex(e,t){let r=nn(e,r$),n={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;let i=r.add(n);if(t.indexState){let r=nn(e,rK);return i.next(e=>{r.put(ah(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=nn(e,r$),n=nn(e,rK),i=nn(e,rJ);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=nn(e,r$),r=nn(e,rJ),n=nn(e,rK);return t.X().next(()=>r.X()).next(()=>n.X())}createTargetIndexes(e,t){return t1.forEach(this.vn(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new aS(t).bn();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=nn(e,rJ),n=!0,i=new Map;return t1.forEach(this.vn(t),t=>this.Fn(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(n){let e=iK(),n=[];return t1.forEach(i,(i,s)=>{tr(aM,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${iy(t)}`);let a=function(e,t){let r=tz(t);if(void 0===r)return null;for(let t of ib(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let r=new Map;for(let n of t$(t))for(let t of ib(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}(s,i),l=function(e,t){let r=[],n=!0;for(let i of t$(t)){let t=0===i.kind?iE(e,i.fieldPath,e.startAt):iI(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new n6(r,n)}(s,i),u=function(e,t){let r=[],n=!0;for(let i of t$(t)){let t=0===i.kind?iI(e,i.fieldPath,e.endAt):iE(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new n6(r,n)}(s,i),h=this.Mn(i,s,l),c=this.Mn(i,s,u),d=this.xn(i,s,o),f=this.On(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return t1.forEach(f,i=>r.Z(i,t.limit).next(t=>{t.forEach(t=>{let r=tN.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}return t1.resolve(null)})}vn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(tl(t instanceof n7||t instanceof n9,34018),t instanceof n7)return t;if(1===t.filters.length)return e(t.filters[0]);let r=t.filters.map(t=>e(t)),n=n9.create(r,t.op);return aA(n=ak(n))?n:(tl(n instanceof n9,64498),tl(ie(n),40251),tl(n.filters.length>1,57927),n.filters.reduce((e,t)=>aD(e,t)))}(function e(t){if(tl(t instanceof n7||t instanceof n9,20012),t instanceof n7){if(t instanceof ic){let e=t.value.arrayValue?.values?.map(e=>n7.create(t.field,"==",e))||[];return n9.create(e,"or")}return t}let r=t.filters.map(t=>e(t));return n9.create(r,t.op)}(e));return tl(aA(t),7391),ax(t)||aC(t)?[t]:t.getFilters()})(n9.create(e.filters,"and")).map(t=>im(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t)),t}On(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Nn(t[h/l]):aL,c=this.Bn(e,o,r[h%l],n),d=this.Ln(e,o,i[h%l],s),f=a.map(t=>this.Bn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}Bn(e,t,r,n){let i=new ab(e,tN.empty(),t,r);return n?i:i.En()}Ln(e,t,r,n){let i=new ab(e,tN.empty(),t,r);return n?i.En():i}Fn(e,t){let r=new aS(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.gn(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.vn(t);return t1.forEach(n,t=>this.Fn(e,t).next(e=>{e?0!==r&&e.fields.length<function(e){let t=new nh(tD.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}(t)&&(r=1):r=0})).next(()=>null!==t.limit&&n.length>1&&2===r?1:r)}kn(e,t){let r=new av;for(let n of t$(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.ln(n.kind);ap.Wt.Dt(e,i)}return r.un()}Nn(e){let t=new av;return ap.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){let r,n=new av;return ap.Wt.Dt(nz(this.databaseId,t),n.ln(0===(r=t$(e)).length?0:r[r.length-1].kind)),n.un()}xn(e,t,r){if(null===r)return[];let n=[];n.push(new av);let i=0;for(let s of t$(e)){let e=r[i++];for(let r of n)if(this.qn(t,s.fieldPath)&&nG(e))n=this.Un(n,s,e);else{let t=r.ln(s.kind);ap.Wt.Dt(e,t)}}return this.$n(n)}Mn(e,t,r){return this.xn(e,t,r.position)}$n(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Un(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new av;n.seed(r.un()),ap.Wt.Dt(e,n.ln(t.kind)),i.push(n)}return i}qn(e,t){return!!e.filters.find(e=>e instanceof n7&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=nn(e,r$),n=nn(e,rK);return(t?r.H(rG,IDBKeyRange.bound(t,t)):r.H()).next(e=>{let t=[];return t1.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{let n,i;t.push((n=r?new tH(r.sequenceNumber,new tJ(an(r.readTime),new tN(rc(r.documentKey)),r.largestBatchId)):tH.empty(),i=e.fields.map(([e,t])=>new tK(tD.fromServerFormat(e),t)),new tj(e.indexId,e.collectionGroup,i,n)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:tE(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=nn(e,r$),i=nn(e,rK);return this.Wn(e).next(e=>n.H(rG,IDBKeyRange.bound(t,t)).next(t=>t1.forEach(t,t=>i.put(ah(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return t1.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?t1.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),t1.forEach(i,r=>this.Qn(e,t,r).next(t=>{let i=this.Gn(n,r);return t.isEqual(i)?t1.resolve():this.zn(e,n,r,t,i)}))))})}jn(e,t,r,n){return nn(e,rJ).put(n.Rn(this.uid,this.Kn(r,t.key),t.key))}Hn(e,t,r,n){return nn(e,rJ).delete(n.An(this.uid,this.Kn(r,t.key),t.key))}Qn(e,t,r){let n=nn(e,rJ),i=new nh(aE);return n.ee({index:rX,range:IDBKeyRange.only([r.indexId,this.uid,a_(this.Kn(r,t))])},(e,n)=>{i=i.add(new ab(r.indexId,t,aT(n.arrayValue),aT(n.directionalValue)))}).next(()=>i)}Gn(e,t){let r=new nh(aE),n=this.kn(t,e);if(null==n)return r;let i=tz(t);if(null!=i){let s=e.data.field(i.fieldPath);if(nG(s))for(let i of s.arrayValue.values||[])r=r.add(new ab(t.indexId,e.key,this.Nn(i),n))}else r=r.add(new ab(t.indexId,e.key,aL,n));return r}zn(e,t,r,n,i){tr(aM,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=nd(s),l=nd(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=nd(a)):t?(i(o),o=nd(s)):(o=nd(s),l=nd(a))}}(n,i,aE,n=>{s.push(this.jn(e,t,r,n))},n=>{s.push(this.Hn(e,t,r,n))}),t1.waitFor(s)}Wn(e){let t=1;return nn(e,rK).ee({index:rQ,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>aE(e,t)).filter((e,t,r)=>!t||0!==aE(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=aE(i,e),s=aE(i,t);if(0===r)n[0]=e.En();else if(r>0&&s<0)n.push(i),n.push(i.En());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.Jn(n[e],n[e+1]))return[];let t=n[e].An(this.uid,aL,tN.empty()),r=n[e+1].An(this.uid,aL,tN.empty());i.push(IDBKeyRange.bound(t,r))}return i}Jn(e,t){return aE(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(aF)}getMinOffset(e,t){return t1.mapArray(this.vn(t),t=>this.Fn(e,t).next(e=>e||ta(44426))).next(aF)}}function aF(e){tl(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>tY(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new tJ(t.readTime,t.documentKey,r)}let aV={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class aB{static withCacheSize(e){return new aB(e,aB.DEFAULT_COLLECTION_PERCENTILE,aB.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function aU(e,t,r){let n=e.store(rm),i=e.store(rE),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.ee({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{tl(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){var h,c;let n=(h=e.key.path,c=r.batchId,[t,rh(h),c]);s.push(i.delete(n)),u.push(e.key)}return t1.waitFor(s).next(()=>u)}function aq(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw ta(14731);t=e.noDocument}return JSON.stringify(t).length}aB.DEFAULT_COLLECTION_PERCENTILE=10,aB.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,aB.DEFAULT=new aB(0x2800000,aB.DEFAULT_COLLECTION_PERCENTILE,aB.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),aB.DISABLED=new aB(-1,0,0);class aj{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Zn={}}static wt(e,t,r,n){return tl(""!==e.uid,64387),new aj(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return a$(e).ee({index:rw,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=nn(e,rE),s=a$(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;tl("number"==typeof a,49019);let f=new sc(a,t,r,n),p=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>sZ(o.yt,e)),d=f.mutations.map(e=>sZ(o.yt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),g=[],m=new nh((e,t)=>tE(e.canonicalString(),t.canonicalString()));for(let e of n){let t=(u=this.userId,h=e.key.path,[u,rh(h),a]);m=m.add(e.key.path.popLast()),g.push(s.put(p)),g.push(i.put(t,rb))}return m.forEach(t=>{g.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[a]=f.keys()}),t1.waitFor(g).next(()=>f)})}lookupMutationBatch(e,t){return a$(e).get(t).next(e=>e?(tl(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),ai(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?t1.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let r=e.keys();return this.Zn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return a$(e).ee({index:rw,range:n},(e,t,n)=>{t.userId===this.userId&&(tl(t.batchId>=r,47524,{Yn:r}),i=ai(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=-1;return a$(e).ee({index:rw,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return a$(e).H(rw,t).next(e=>e.map(e=>ai(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=[this.userId,rh(t.path)],n=IDBKeyRange.lowerBound(r),i=[];return nn(e,rE).ee({range:n},(r,n,s)=>{let[a,o,l]=r,u=rc(o);if(a===this.userId&&t.path.isEqual(u))return a$(e).get(l).next(e=>{if(!e)throw ta(61480,{er:r,batchId:l});tl(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(ai(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new nh(tE),n=[];return t.forEach(t=>{let i=[this.userId,rh(t.path)],s=IDBKeyRange.lowerBound(i),a=nn(e,rE).ee({range:s},(e,n,i)=>{let[s,a,o]=e,l=rc(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),t1.waitFor(n).next(()=>this.tr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=[this.userId,rh(r)],s=IDBKeyRange.lowerBound(i),a=new nh(tE);return nn(e,rE).ee({range:s},(e,t,i)=>{let[s,o,l]=e,u=rc(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.tr(e,a))}tr(e,t){let r=[],n=[];return t.forEach(t=>{n.push(a$(e).get(t).next(e=>{if(null===e)throw ta(35274,{batchId:t});tl(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(ai(this.serializer,e))}))}),t1.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return aU(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.nr(t.batchId)}),t1.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return t1.resolve();let r=IDBKeyRange.lowerBound([this.userId]),n=[];return nn(e,rE).ee({range:r},(e,t,r)=>{if(e[0]===this.userId){let t=rc(e[1]);n.push(t)}else r.done()}).next(()=>{tl(0===n.length,56720,{rr:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return az(e,this.userId,t)}ir(e){return nn(e,rg).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function az(e,t,r){let n=[t,rh(r.path)],i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return nn(e,rE).ee({range:s,Y:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function a$(e){return nn(e,rm)}class aG{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new aG(0)}static ar(){return new aG(-1)}}class aK{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next(t=>{let r=new aG(t.highestTargetId);return t.highestTargetId=r.next(),this.cr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.ur(e).next(e=>tq.fromTimestamp(new tU(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.ur(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.ur(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.cr(e,n)))}addTargetData(e,t){return this.lr(e,t).next(()=>this.ur(e).next(r=>(r.targetCount+=1,this.hr(t,r),this.cr(e,r))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>nn(e,rN).delete(t.targetId)).next(()=>this.ur(e)).next(t=>(tl(t.targetCount>0,8065),t.targetCount-=1,this.cr(e,t)))}removeTargets(e,t,r){let n=0,i=[];return nn(e,rN).ee((s,a)=>{let o=as(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>t1.waitFor(i)).next(()=>n)}forEachTarget(e,t){return nn(e,rN).ee((e,r)=>{t(as(r))})}ur(e){return nn(e,rV).get(rF).next(e=>(tl(null!==e,2888),e))}cr(e,t){return nn(e,rV).put(rF,t)}lr(e,t){return nn(e,rN).put(aa(this.serializer,t))}hr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.ur(e).next(e=>e.targetCount)}getTargetData(e,t){let r=iy(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),i=null;return nn(e,rN).ee({range:n,index:rk},(e,r,n)=>{let s=as(r);iw(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=aH(e);return t.forEach(t=>{let s=rh(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),t1.waitFor(n)}removeMatchingKeys(e,t,r){let n=aH(e);return t1.forEach(t,t=>{let i=rh(t.path);return t1.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=aH(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=aH(e),i=iK();return n.ee({range:r,Y:!0},(e,t,r)=>{let n=new tN(rc(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=rh(t.path),n=IDBKeyRange.bound([r],[r+"\0"],!1,!0),i=0;return aH(e).ee({index:rL,Y:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}At(e,t){return nn(e,rN).get(t).next(e=>e?as(e):null)}}function aH(e){return nn(e,rO)}let aQ="LruGarbageCollector";function aW([e,t],[r,n]){let i=tE(e,r);return 0===i?tE(t,n):i}class aJ{constructor(e){this.Pr=e,this.buffer=new nh(aW),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>aW(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class aY{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){tr(aQ,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){t7(e)?tr(aQ,"Ignoring IndexedDB error during garbage collection: ",e):await t0(e)}await this.Ar(3e5)})}}class aX{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return t1.resolve(ra.ce);let r=new aJ(t);return this.Vr.forEachTarget(e,e=>r.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>r.Er(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(tr("LruGarbageCollector","Garbage collection skipped; disabled"),t1.resolve(aV)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(tr("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),aV):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,n,i,a,o,l,u,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(tr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,a=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,o=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(u=Date.now(),tt()<=s.DEBUG&&tr("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-h}ms
	Determined least recently used ${n} in `+(o-a)+"ms\n"+`	Removed ${i} targets in `+(l-o)+"ms\n"+`	Removed ${e} documents in `+(u-l)+"ms\n"+`Total Duration: ${u-h}ms`),t1.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}class aZ{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new aX(e,t)}(this,t)}dr(e){let t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,(e,r)=>t(r))}addReference(e,t,r){return a0(e,r)}removeReference(e,t,r){return a0(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return a0(e,t)}wr(e,t){let r;return r=!1,nn(e,rg).te(n=>az(e,n,t).next(e=>(e&&(r=!0),t1.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.yr(e,(s,a)=>{if(a<=t){let t=this.wr(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,tq.min()),aH(e).delete([0,rh(s.path)])))});n.push(t)}}).next(()=>t1.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return a0(e,t)}yr(e,t){let r=aH(e),n,i=ra.ce;return r.ee({index:rL},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==ra.ce&&t(new tN(rc(n)),i),i=a,n=s):i=ra.ce}).next(()=>{i!==ra.ce&&t(new tN(rc(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function a0(e,t){var r;return aH(e).put((r=e.currentSequenceNumber,{targetId:0,path:rh(t.path),sequenceNumber:r}))}class a1{constructor(){this.changes=new iV(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,n2.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?t1.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class a2{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return nn(e,rI).put(r)}removeEntry(e,t,r){let n;return nn(e,rI).delete([(n=t.path.toArray()).slice(0,n.length-2),n[n.length-2],at(r),n[n.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.br(e,r)))}getEntry(e,t){let r=n2.newInvalidDocument(t);return nn(e,rI).ee({index:rT,range:IDBKeyRange.only(a3(t))},(e,n)=>{r=this.Sr(t,n)}).next(()=>r)}Dr(e,t){let r={size:0,document:n2.newInvalidDocument(t)};return nn(e,rI).ee({index:rT,range:IDBKeyRange.only(a3(t))},(e,n)=>{r={document:this.Sr(t,n),size:aq(n)}}).next(()=>r)}getEntries(e,t){let r=iB;return this.Cr(e,t,(e,t)=>{let n=this.Sr(e,t);r=r.insert(e,n)}).next(()=>r)}vr(e,t){let r=iB,n=new no(tN.comparator);return this.Cr(e,t,(e,t)=>{let i=this.Sr(e,t);r=r.insert(e,i),n=n.insert(e,aq(t))}).next(()=>({documents:r,Fr:n}))}Cr(e,t,r){if(t.isEmpty())return t1.resolve();let n=new nh(a4);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(a3(n.first()),a3(n.last())),s=n.getIterator(),a=s.getNext();return nn(e,rI).ee({index:rT,range:i},(e,t,n)=>{let i=tN.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>a4(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.j(a3(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),at(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return nn(e,rI).H(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=iB;for(let i of e){let e=this.Sr(tN.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(iL(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=iB,s=a5(t,r),a=a5(t,tJ.max());return nn(e,rI).ee({index:rx,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.Sr(tN.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new a6(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return nn(e,rA).get(rD).next(e=>(tl(!!e,20021),e))}br(e,t){return nn(e,rA).put(rD,t)}Sr(e,t){if(t){let e=function(e,t){var r;let n,i;if(t.document)n=sX(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=tN.fromSegments(t.noDocument.path),r=an(t.noDocument.readTime);n=n2.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return ta(56709);{let e=tN.fromSegments(t.unknownDocument.path),r=an(t.unknownDocument.version);n=n2.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime((i=new tU((r=t.readTime)[0],r[1]),tq.fromTimestamp(i))),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(tq.min())))return e}return n2.newInvalidDocument(e)}}class a6 extends a1{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new iV(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new nh((e,t)=>tE(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Or.get(i);if(t.push(this.Mr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=ae(this.Mr.serializer,s);n=n.add(i.path.popLast());let l=aq(o);r+=l-a.size,t.push(this.Mr.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=ae(this.Mr.serializer,s.convertToNoDocument(tq.min()));t.push(this.Mr.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.Mr.updateMetadata(e,r)),t1.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next(e=>(this.Or.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Mr.vr(e,t).next(({documents:e,Fr:t})=>(t.forEach((t,r)=>{this.Or.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function a3(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function a5(e,t){let r=t.documentKey.path.toArray();return[e,at(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function a4(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=tE(r[e],n[e]))return i;return(i=tE(r.length,n.length))||(i=tE(r[r.length-2],n[n.length-2]))||tE(r[r.length-1],n[n.length-1])}class a8{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class a7{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&sr(r.mutation,e,nf.empty(),tU.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,iK()).next(()=>t))}getLocalViewOfDocuments(e,t,r=iK()){let n=iz();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=iq();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=iz();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,iK()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=iB,s=iz(),a=iz();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof ss)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),sr(a.mutation,t,a.mutation.getFieldMask(),tU.now())):s.set(t.key,nf.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new a8(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=iz(),n=new no((e,t)=>e-t),i=iK();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||nf.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||iK()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=iz();l.forEach(e=>{if(!i.has(e)){let n=st(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return t1.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return tN.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ix(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):t1.resolve(iz()),a=-1,o=i;return s.next(t=>t1.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t)?t1.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,iK())).next(e=>({batchId:a,changes:ij(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new tN(t)).next(e=>{let t=iq();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=iq();return this.indexManager.getCollectionParents(e,i).next(a=>t1.forEach(a,a=>{let o=new i_(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,n2.newInvalidDocument(n)))});let r=iq();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&sr(s.mutation,n,nf.empty(),tU.now()),iL(t,n)&&(r=r.insert(e,n))}),r})}}class a9{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return t1.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,{id:t.id,version:t.version,createTime:sq(t.createTime)}),t1.resolve()}getNamedQuery(e,t){return t1.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,{name:t.name,query:ao(t.bundledQuery),readTime:sq(t.readTime)}),t1.resolve()}}class oe{constructor(){this.overlays=new no(tN.comparator),this.Lr=new Map}getOverlay(e,t){return t1.resolve(this.overlays.get(t))}getOverlays(e,t){let r=iz();return t1.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.bt(e,t,n)}),t1.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.Lr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(r)),t1.resolve()}getOverlaysForCollection(e,t,r){let n=iz(),i=t.length+1,s=new tN(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return t1.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new no((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=iz(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=iz(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return t1.resolve(a)}bt(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.Lr.get(n.largestBatchId).delete(r.key);this.Lr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new sf(t,r));let i=this.Lr.get(t);void 0===i&&(i=iK(),this.Lr.set(t,i)),this.Lr.set(t,i.add(r.key))}}class ot{constructor(){this.sessionToken=ng.EMPTY_BYTE_STRING}getSessionToken(e){return t1.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,t1.resolve()}}class or{constructor(){this.kr=new nh(on.Kr),this.qr=new nh(on.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let r=new on(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new on(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){let t=new tN(new tC([])),r=new on(t,e),n=new on(t,e+1),i=[];return this.qr.forEachInRange([r,n],e=>{this.Wr(e),i.push(e.key)}),i}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new tN(new tC([])),r=new on(t,e),n=new on(t,e+1),i=iK();return this.qr.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new on(e,0),r=this.kr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class on{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return tN.comparator(e.key,t.key)||tE(e.Hr,t.Hr)}static Ur(e,t){return tE(e.Hr,t.Hr)||tN.comparator(e.key,t.key)}}class oi{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new nh(on.Kr)}checkEmpty(e){return t1.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new sc(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.Jr=this.Jr.add(new on(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return t1.resolve(s)}lookupMutationBatch(e,t){return t1.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.Xr(t+1),n=r<0?0:r;return t1.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return t1.resolve(0===this.mutationQueue.length?-1:this.Yn-1)}getAllMutationBatches(e){return t1.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new on(t,0),n=new on(t,1/0),i=[];return this.Jr.forEachInRange([r,n],e=>{let t=this.Zr(e.Hr);i.push(t)}),t1.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new nh(tE);return t.forEach(e=>{let t=new on(e,0),n=new on(e,1/0);this.Jr.forEachInRange([t,n],e=>{r=r.add(e.Hr)})}),t1.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;tN.isDocumentKey(i)||(i=i.child(""));let s=new on(new tN(i),0),a=new nh(tE);return this.Jr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Hr)),!0)},s),t1.resolve(this.Yr(a))}Yr(e){let t=[];return e.forEach(e=>{let r=this.Zr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){tl(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Jr;return t1.forEach(t.mutations,n=>{let i=new on(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){let r=new on(t,0),n=this.Jr.firstAfterOrEqual(r);return t1.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,t1.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class os{constructor(e){this.ti=e,this.docs=new no(tN.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return t1.resolve(r?r.document.mutableCopy():n2.newInvalidDocument(t))}getEntries(e,t){let r=iB;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():n2.newInvalidDocument(e))}),t1.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=iB,s=t.path,a=new tN(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=tY(tW(a),r)||(n.has(a.key)||iL(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return t1.resolve(i)}getAllFromCollectionGroup(e,t,r,n){ta(9500)}ni(e,t){return t1.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new oa(this)}getSize(e){return t1.resolve(this.size)}}class oa extends a1{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Mr.addEntry(e,n)):this.Mr.removeEntry(r)}),t1.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class oo{constructor(e){this.persistence=e,this.ri=new iV(e=>iy(e),iw),this.lastRemoteSnapshotVersion=tq.min(),this.highestTargetId=0,this.ii=0,this.si=new or,this.targetCount=0,this.oi=aG._r()}forEachTarget(e,t){return this.ri.forEach((e,r)=>t(r)),t1.resolve()}getLastRemoteSnapshotVersion(e){return t1.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return t1.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),t1.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),t1.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new aG(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,t1.resolve()}updateTargetData(e,t){return this.lr(t),t1.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,t1.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.ri.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.ri.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),t1.waitFor(i).next(()=>n)}getTargetCount(e){return t1.resolve(this.targetCount)}getTargetData(e,t){let r=this.ri.get(t)||null;return t1.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),t1.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),t1.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),t1.resolve()}getMatchingKeysForTargetId(e,t){let r=this.si.jr(t);return t1.resolve(r)}containsKey(e,t){return t1.resolve(this.si.containsKey(t))}}class ol{constructor(e,t){this._i={},this.overlays={},this.ai=new ra(0),this.ui=!1,this.ui=!0,this.ci=new ot,this.referenceDelegate=e(this),this.li=new oo(this),this.indexManager=new aR,this.remoteDocumentCache=function(e){return new os(e)}(e=>this.referenceDelegate.hi(e)),this.serializer=new s9(t),this.Pi=new a9(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new oe,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new oi(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){tr("MemoryPersistence","Starting transaction:",e);let n=new ou(this.ai.next());return this.referenceDelegate.Ti(),r(n).next(e=>this.referenceDelegate.Ii(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ei(e,t){return t1.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}}class ou extends tZ{constructor(e){super(),this.currentSequenceNumber=e}}class oh{constructor(e){this.persistence=e,this.Ri=new or,this.Ai=null}static Vi(e){return new oh(e)}get di(){if(this.Ai)return this.Ai;throw ta(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),t1.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),t1.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),t1.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return t1.forEach(this.di,r=>{let n=tN.fromPath(r);return this.mi(e,n).next(e=>{e||t.removeEntry(n,tq.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return t1.or([()=>t1.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class oc{constructor(e,t){this.persistence=e,this.fi=new iV(e=>rh(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new aX(e,t)}(this,t)}static Vi(e,t){return new oc(e,t)}Ti(){}Ii(e){return t1.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return t1.forEach(this.fi,(r,n)=>this.wr(e,r,n).next(e=>e?t1.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.ni(e,n=>this.wr(e,n,t).next(e=>{e||(r++,i.removeEntry(n,tq.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),t1.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),t1.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),t1.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),t1.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(nP(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=nS(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return nv(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let i;return n=t.mapValue,i=0,ns(n.fields,(t,r)=>{i+=t.length+e(r)}),i;default:throw ta(13486,{value:t})}}(e.data.value)),t}wr(e,t,r){return t1.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.fi.get(t);return t1.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class od{constructor(e){this.serializer=e}k(e,t,r,n){let i=new t6("createOrUpgrade",t);r<1&&n>=1&&(e.createObjectStore(rf),e.createObjectStore(rg,{keyPath:"userId"}),e.createObjectStore(rm,{keyPath:ry,autoIncrement:!0}).createIndex(rw,rv,{unique:!0}),e.createObjectStore(rE),of(e),e.createObjectStore(rd));let s=t1.resolve();return r<3&&n>=3&&(0!==r&&(e.deleteObjectStore(rO),e.deleteObjectStore(rN),e.deleteObjectStore(rV),of(e)),s=s.next(()=>{let e,t;return e=i.store(rV),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:tq.min().toTimestamp(),targetCount:0},e.put(rF,t)})),r<4&&n>=4&&(0!==r&&(s=s.next(()=>i.store(rm).H().next(t=>{e.deleteObjectStore(rm),e.createObjectStore(rm,{keyPath:ry,autoIncrement:!0}).createIndex(rw,rv,{unique:!0});let r=i.store(rm),n=t.map(e=>r.put(e));return t1.waitFor(n)}))),s=s.next(()=>{e.createObjectStore(rq,{keyPath:"clientId"})})),r<5&&n>=5&&(s=s.next(()=>this.gi(i))),r<6&&n>=6&&(s=s.next(()=>(e.createObjectStore(rA),this.pi(i)))),r<7&&n>=7&&(s=s.next(()=>this.yi(i))),r<8&&n>=8&&(s=s.next(()=>this.wi(e,i))),r<9&&n>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&n>=10&&(s=s.next(()=>this.bi(i))),r<11&&n>=11&&(s=s.next(()=>{e.createObjectStore(rj,{keyPath:"bundleId"}),e.createObjectStore(rz,{keyPath:"name"})})),r<12&&n>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore(r0,{keyPath:r1})).createIndex(r2,r6,{unique:!1}),t.createIndex(r3,r5,{unique:!1})})),r<13&&n>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore(rI,{keyPath:r_})).createIndex(rT,rS),t.createIndex(rx,rC)}).next(()=>this.Si(e,i)).next(()=>e.deleteObjectStore(rd))),r<14&&n>=14&&(s=s.next(()=>this.Di(e,i))),r<15&&n>=15&&(s=s.next(()=>{e.createObjectStore(r$,{keyPath:"indexId",autoIncrement:!0}).createIndex(rG,"collectionGroup",{unique:!1}),e.createObjectStore(rK,{keyPath:rH}).createIndex(rQ,rW,{unique:!1}),e.createObjectStore(rJ,{keyPath:rY}).createIndex(rX,rZ,{unique:!1})})),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(rK).clear()}).next(()=>{t.objectStore(rJ).clear()})),r<17&&n>=17&&(s=s.next(()=>{e.createObjectStore(r4,{keyPath:"name"})})),r<18&&n>=18&&U()&&(s=s.next(()=>{t.objectStore(rK).clear()}).next(()=>{t.objectStore(rJ).clear()})),s}pi(e){let t=0;return e.store(rd).ee((e,r)=>{t+=aq(r)}).next(()=>{let r={byteSize:t};return e.store(rA).put(rD,r)})}gi(e){let t=e.store(rg),r=e.store(rm);return t.H().next(t=>t1.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.H(rw,n).next(r=>t1.forEach(r,r=>{tl(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=ai(this.serializer,r);return aU(e,t.userId,n).next(()=>{})}))}))}yi(e){let t=e.store(rO),r=e.store(rd);return e.store(rV).get(rF).next(e=>{let n=[];return r.ee((r,i)=>{let s=new tC(r),a=[0,rh(s)];n.push(t.get(a).next(r=>r?t1.resolve():t.put({targetId:0,path:rh(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>t1.waitFor(n))})}wi(e,t){e.createObjectStore(rB,{keyPath:rU});let r=t.store(rB),n=new aO,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:rh(n)})}};return t.store(rd).ee({Y:!0},(e,t)=>i(new tC(e).popLast())).next(()=>t.store(rE).ee({Y:!0},([e,t,r],n)=>i(rc(t).popLast())))}bi(e){let t=e.store(rN);return t.ee((e,r)=>{let n=as(r),i=aa(this.serializer,n);return t.put(i)})}Si(e,t){let r=t.store(rd),n=[];return r.ee((e,r)=>{let i=t.store(rI),s=(r.document?new tN(tC.fromString(r.document.name).popFirst(5)):r.noDocument?tN.fromSegments(r.noDocument.path):r.unknownDocument?tN.fromSegments(r.unknownDocument.path):ta(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>t1.waitFor(n))}Di(e,t){let r=t.store(rm),n=new a2(this.serializer),i=new ol(oh.Vi,this.serializer.yt);return r.H().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??iK();ai(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),t1.forEach(r,(e,r)=>{let s=new e7(r),a=ad.wt(this.serializer,s),o=i.getIndexManager(s);return new a7(n,aj.wt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new nr(t,ra.ce),e).next()})})}}function of(e){e.createObjectStore(rO,{keyPath:rM}).createIndex(rL,rP,{unique:!0}),e.createObjectStore(rN,{keyPath:"targetId"}).createIndex(rk,rR,{unique:!0}),e.createObjectStore(rV)}let op="IndexedDbPersistence",og="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class om{constructor(e,t,r,n,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Ci=i,this.window=s,this.document=a,this.Fi=l,this.Mi=u,this.xi=h,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=-1/0,this.ki=e=>Promise.resolve(),!om.v())throw new th(tu.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new aZ(this,n),this.Ki=t+"main",this.serializer=new s9(o),this.qi=new t3(this.Ki,this.xi,new od(this.serializer)),this.ci=new af,this.li=new aK(this.referenceDelegate,this.serializer),this.remoteDocumentCache=function(e){return new a2(e)}(this.serializer),this.Pi=new ac,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===u&&tn(op,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new th(tu.FAILED_PRECONDITION,og);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.li.getHighestSequenceNumber(e))}).then(e=>{this.ai=new ra(e,this.Fi)}).then(()=>{this.ui=!0}).catch(e=>(this.qi&&this.qi.close(),Promise.reject(e)))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget(async()=>{this.started&&await this.$i()}))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>nn(e,rq).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ji(e).next(e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Ji(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(t7(e))return tr(op,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return tr(op,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable(()=>this.ki(e)),this.isPrimary=e})}ji(e){return nn(e,rf).get(rp).next(e=>t1.resolve(this.Xi(e)))}Yi(e){return nn(e,rq).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,18e5)){this.Li=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=nn(e,rq);return t.H().next(e=>{let r=this.ns(e,18e5),n=e.filter(e=>-1===r.indexOf(e));return t1.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.$i().then(()=>this.es()).then(()=>this.Gi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?t1.resolve(!0):nn(e,rf).get(rp).next(t=>{if(null!==t&&this.ts(t.leaseTimestampMs,5e3)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new th(tu.FAILED_PRECONDITION,og);return!1}}return!(!this.networkEnabled||!this.inForeground)||nn(e,rq).H().next(e=>void 0===this.ns(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&tr(op,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[rf,rq],e=>{let t=new nr(e,ra.ce);return this.Ji(t).next(()=>this.Yi(t))}),this.qi.close(),this.ls()}ns(e,t){return e.filter(e=>this.ts(e.updateTimeMs,t)&&!this.ss(e.clientId))}hs(){return this.runTransaction("getActiveClients","readonly",e=>nn(e,rq).H().next(e=>this.ns(e,18e5).map(e=>e.clientId)))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return aj.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new aP(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return ad.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,r){var n;let i;tr(op,"Starting transaction:",e);let s=18===(n=this.xi)||17===n?nt:16===n||15===n?ne:14===n||13===n?r9:12===n?r7:11===n?r8:void ta(60245);return this.qi.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,n=>(i=new nr(n,this.ai?this.ai.next():ra.ce),"readwrite-primary"===t?this.ji(i).next(e=>!!e||this.Hi(i)).next(t=>{if(!t)throw tn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)),new th(tu.FAILED_PRECONDITION,tX);return r(i)}).next(e=>this.Zi(i).next(()=>e)):this.Ps(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Ps(e){return nn(e,rf).get(rp).next(e=>{if(null!==e&&this.ts(e.leaseTimestampMs,5e3)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new th(tu.FAILED_PRECONDITION,og)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return nn(e,rf).put(rp,t)}static v(){return t3.v()}Ji(e){let t=nn(e,rf);return t.get(rp).next(e=>this.Xi(e)?(tr(op,"Releasing primary lease."),t.delete(rp)):t1.resolve())}ts(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(tn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=()=>{this.Ci.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.$i()))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){"function"==typeof this.window?.addEventListener&&(this.Oi=()=>{this._s();let e=/(?:Version|Mobile)\/1[456]/;B()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{let t=null!==this.Ui?.getItem(this.rs(e));return tr(op,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return tn(op,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){tn("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch(e){}}rs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function oy(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class ow{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=n}static Es(e,t){let r=iK(),n=iK();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new ow(e,t.fromCache,r,n)}}class ov{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ob{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=B()?8:t5(P())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.gs(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ps(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new ov;return this.ys(e,t,r).next(n=>{if(i.result=n,this.As)return this.ws(e,t,r,n.size)})}).next(()=>i.result)}ws(e,t,r,n){return r.documentReadCount<this.Vs?(tt()<=s.DEBUG&&tr("QueryEngine","SDK will not create cache indexes for query:",iM(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),t1.resolve()):(tt()<=s.DEBUG&&tr("QueryEngine","Query:",iM(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.ds*n?(tt()<=s.DEBUG&&tr("QueryEngine","The SDK decides to create cache indexes for query:",iM(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,iA(t))):t1.resolve())}gs(e,t){if(iS(t))return t1.resolve(null);let r=iA(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=iA(t=ik(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=iK(...n);return this.fs.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.bs(t,n);return this.Ss(t,s,i,r.readTime)?this.gs(e,ik(t,null,"F")):this.Ds(e,s,t,r)}))})))}ps(e,t,r,n){return iS(t)||n.isEqual(tq.min())?t1.resolve(null):this.fs.getDocuments(e,r).next(i=>{let a=this.bs(t,i);return this.Ss(t,a,r,n)?t1.resolve(null):(tt()<=s.DEBUG&&tr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),iM(t)),this.Ds(e,a,t,tQ(n,-1)).next(e=>e))})}bs(e,t){let r=new nh(iF(e));return t.forEach((t,n)=>{iL(e,n)&&(r=r.add(n))}),r}Ss(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}ys(e,t,r){return tt()<=s.DEBUG&&tr("QueryEngine","Using full collection scan to execute query:",iM(t)),this.fs.getDocumentsMatchingQuery(e,t,tJ.min(),r)}Ds(e,t,r,n){return this.fs.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let oE="LocalStore";class oI{constructor(e,t,r,n){this.persistence=e,this.Cs=t,this.serializer=n,this.vs=new no(tE),this.Fs=new iV(e=>iy(e),iw),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new a7(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}async function o_(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(i=>(n=i,e.Os(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let i=[],s=[],a=iK();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({Ns:e,removedBatchIds:i,addedBatchIds:s}))})})}function oT(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function oS(e,t,r){let n=iK(),i=iK();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=iB;return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(tq.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):tr(oE,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{Bs:n,Ls:i}})}function ox(e,t){return e.persistence.runTransaction("Allocate target","readwrite",r=>{let n;return e.li.getTargetData(r,t).next(i=>i?(n=i,t1.resolve(n)):e.li.allocateTargetId(r).next(i=>(n=new s7(t,i,"TargetPurposeListen",r.currentSequenceNumber),e.li.addTargetData(r,n).next(()=>n))))}).then(r=>{let n=e.vs.get(r.targetId);return(null===n||r.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.vs=e.vs.insert(r.targetId,r),e.Fs.set(t,r.targetId)),r})}async function oC(e,t,r){let n=e.vs.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!t7(e))throw e;tr(oE,`Failed to update sequence numbers for target ${t}: ${e}`)}e.vs=e.vs.remove(t),e.Fs.delete(n.target)}function oA(e,t,r){let n=tq.min(),i=iK();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=iA(t),void 0!==(o=e.Fs.get(a))?t1.resolve(e.vs.get(o)):e.li.getTargetData(s,a)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.li.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(s,t,r?n:tq.min(),r?i:iK())).next(r=>(ok(e,iP(t),r),{documents:r,ks:i}))})}function oD(e,t){let r=e.li,n=e.vs.get(t);return n?Promise.resolve(n.target):e.persistence.runTransaction("Get target data","readonly",e=>r.At(e,t).next(e=>e?e.target:null))}function oN(e,t){let r=e.Ms.get(t)||tq.min();return e.persistence.runTransaction("Get new document changes","readonly",n=>e.xs.getAllFromCollectionGroup(n,t,tQ(r,-1),Number.MAX_SAFE_INTEGER)).then(r=>(ok(e,t,r),r))}function ok(e,t,r){let n=e.Ms.get(t)||tq.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.Ms.set(t,n)}async function oR(e,t,r,n){let i=iK(),s=iB;for(let e of r){let r=t.Ks(e.metadata.name);e.document&&(i=i.add(r));let n=t.qs(e);n.setReadTime(t.Us(e.metadata.readTime)),s=s.insert(r,n)}let a=e.xs.newChangeBuffer({trackRemovals:!0}),o=await ox(e,iA(iT(tC.fromString(`__bundle__/docs/${n}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>oS(t,a,s).next(e=>(a.apply(t),e)).next(r=>e.li.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.li.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,r.Bs,r.Ls)).next(()=>r.Bs)))}async function oO(e,t,r=iK()){let n=await ox(e,iA(ao(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=sq(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return e.Pi.saveNamedQuery(i,t);let a=n.withResumeToken(ng.EMPTY_BYTE_STRING,s);return e.vs=e.vs.insert(a.targetId,a),e.li.updateTargetData(i,a).next(()=>e.li.removeMatchingKeysForTargetId(i,n.targetId)).next(()=>e.li.addMatchingKeys(i,r,n.targetId)).next(()=>e.Pi.saveNamedQuery(i,t))})}let oM="firestore_clients";function oL(e,t){return`${oM}_${e}_${t}`}let oP="firestore_mutations";function oF(e,t,r){let n=`${oP}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let oV="firestore_targets";function oB(e,t){return`${oV}_${e}_${t}`}let oU="SharedClientState";class oq{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static $s(e,t,r){let n=JSON.parse(r),i,s="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new th(n.error.code,n.error.message)),s?new oq(e,t,n.state,i):(tn(oU,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class oj{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static $s(e,t){let r=JSON.parse(t),n,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new th(r.error.code,r.error.message)),i?new oj(e,r.state,n):(tn(oU,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class oz{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=iH;for(let e=0;n&&e<r.activeTargetIds.length;++e)n=ru(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new oz(e,i):(tn(oU,`Failed to parse client data for instance '${e}': ${t}`),null)}}class o${constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new o$(t.clientId,t.onlineState):(tn(oU,`Failed to parse online state: ${e}`),null)}}class oG{constructor(){this.activeTargetIds=iH}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class oK{constructor(e,t,r,n,i){this.window=e,this.Ci=t,this.persistenceKey=r,this.zs=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new no(tE),this.started=!1,this.Zs=[];const s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Xs=oL(this.persistenceKey,this.zs),this.Ys=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.Js=this.Js.insert(this.zs,new oG),this.eo=RegExp(`^${oM}_${s}_([^_]*)$`),this.no=RegExp(`^${oP}_${s}_(\\d+)(?:_(.*))?$`),this.ro=RegExp(`^${oV}_${s}_(\\d+)$`),this.io=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.so=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.hs())){if(e===this.zs)continue;let t=this.getItem(oL(this.persistenceKey,e));if(t){let r=oz.$s(e,t);r&&(this.Js=this.Js.insert(r.clientId,r))}}this.oo();let e=this.storage.getItem(this.io);if(e){let t=this._o(e);t&&this.ao(t)}for(let e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,r){this.co(e,t,r),this.lo(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(oB(this.persistenceKey,e));if(t){let n=oj.$s(e,t);n&&(r=n.state)}}return t&&this.ho.Qs(e),this.oo(),r}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(oB(this.persistenceKey,e))}updateQueryState(e,t,r){this.Po(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.lo(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return tr(oU,"READ",e,t),t}setItem(e,t){tr(oU,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){tr(oU,"REMOVE",e),this.storage.removeItem(e)}Hs(e){if(e.storageArea===this.storage){if(tr(oU,"EVENT",e.key,e.newValue),e.key===this.Xs)return void tn("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.eo.test(e.key)){if(null==e.newValue){let t=this.Eo(e.key);return this.Ro(t,null)}{let t=this.Ao(e.key,e.newValue);if(t)return this.Ro(t.clientId,t)}}else if(this.no.test(e.key)){if(null!==e.newValue){let t=this.Vo(e.key,e.newValue);if(t)return this.mo(t)}}else if(this.ro.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(e.key===this.io){if(null!==e.newValue){let t=this._o(e.newValue);if(t)return this.ao(t)}}else if(e.key===this.Ys){let t=function(e){let t=ra.ce;if(null!=e)try{let r=JSON.parse(e);tl("number"==typeof r,30636,{yo:e}),t=r}catch(e){tn(oU,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==ra.ce&&this.sequenceNumberHandler(t)}else if(e.key===this.so){let t=this.wo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.bo(e)))}}}else this.Zs.push(e)})}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,r){let n=new oq(this.currentUser,e,t,r),i=oF(this.persistenceKey,this.currentUser,e);this.setItem(i,n.Ws())}lo(e){let t=oF(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){let t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,r){let n=oB(this.persistenceKey,e),i=new oj(e,t,r);this.setItem(n,i.Ws())}Io(e){let t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){let t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){let r=this.Eo(e);return oz.$s(r,t)}Vo(e,t){let r=this.no.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return oq.$s(new e7(i),n,t)}fo(e,t){let r=Number(this.ro.exec(e)[1]);return oj.$s(r,t)}_o(e){return o$.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);tr(oU,`Ignoring mutation for non-active user ${e.user.uid}`)}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){let r=t?this.Js.insert(e,t):this.Js.remove(e),n=this.uo(this.Js),i=this.uo(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Co(s,a).then(()=>{this.Js=r})}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=iH;return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class oH{constructor(){this.vo=new oG,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new oG,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class oQ{Mo(e){}shutdown(){}}let oW="ConnectivityMonitor";class oJ{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){for(let e of(tr(oW,"Network connectivity changed: AVAILABLE"),this.Lo))e(0)}Bo(){for(let e of(tr(oW,"Network connectivity changed: UNAVAILABLE"),this.Lo))e(1)}static v(){return"u">typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let oY=null;function oX(){return null===oY?oY=0x10000000+Math.round(0x80000000*Math.random()):oY++,"0x"+oY.toString(16)}let oZ="RestConnection",o0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class o1{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${n}`,this.$o=this.databaseId.database===nA?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Wo(e,t,r,n,i){let s=oX(),a=this.Qo(e,t.toUriEncodedString());tr(oZ,`Sending RPC '${e}' ${s}:`,a,r);let o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(o,n,i);let{host:l}=new URL(a),u=R(l);return this.zo(e,a,o,r,u).then(t=>(tr(oZ,`Received RPC '${e}' ${s}: `,t),t),t=>{throw ti(oZ,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",r),t})}jo(e,t,r,n,i,s){return this.Wo(e,t,r,n,i)}Go(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+e9,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}Qo(e,t){let r=o0[e],n=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(n=`${n}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),n}terminate(){}}class o2{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}let o6="WebChannelConnection",o3=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};class o5 extends o1{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){o5.c_||(o3(p(),f.STAT_EVENT,e=>{e.stat===d.PROXY?tr(o6,"STAT_EVENT: detected buffering proxy"):e.stat===d.NOPROXY&&tr(o6,"STAT_EVENT: detected no buffering proxy")}),o5.c_=!0)}zo(e,t,r,n,i){let s=oX();return new Promise((i,a)=>{let o=new l;o.setWithCredentials(!0),o.listenOnce(h.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case c.NO_ERROR:let t=o.getResponseJson();tr(o6,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case c.TIMEOUT:tr(o6,`RPC '${e}' ${s} timed out`),a(new th(tu.DEADLINE_EXCEEDED,"Request time out"));break;case c.HTTP_ERROR:let r=o.getStatus();if(tr(o6,`RPC '${e}' ${s} failed with status:`,r,"response text:",o.getResponseText()),r>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,r=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(tu).indexOf(e)>=0?e:tu.UNKNOWN);a(new th(r,t.message))}else a(new th(tu.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new th(tu.UNAVAILABLE,"Connection failed."));break;default:ta(9055,{l_:e,streamId:s,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{tr(o6,`RPC '${e}' ${s} completed.`)}});let u=JSON.stringify(n);tr(o6,`RPC '${e}' ${s} sending request:`,n),o.send(t,"POST",u,r,15)})}T_(e,t,r){let n=oX(),i=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=this.createWebChannelTransport(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},o=this.longPollingOptions.timeoutSeconds;void 0!==o&&(a.longPollingTimeout=Math.round(1e3*o)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Go(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;let l=i.join("");tr(o6,`Creating RPC '${e}' stream ${n}: ${l}`,a);let h=s.createWebChannel(l,a);this.I_(h);let c=!1,d=!1,f=new o2({Ho:t=>{d?tr(o6,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(c||(tr(o6,`Opening RPC '${e}' stream ${n} transport.`),h.open(),c=!0),tr(o6,`RPC '${e}' stream ${n} sending:`,t),h.send(t))},Jo:()=>h.close()});return o3(h,u.EventType.OPEN,()=>{d||(tr(o6,`RPC '${e}' stream ${n} transport opened.`),f.i_())}),o3(h,u.EventType.CLOSE,()=>{d||(d=!0,tr(o6,`RPC '${e}' stream ${n} transport closed`),f.o_(),this.E_(h))}),o3(h,u.EventType.ERROR,t=>{d||(d=!0,ti(o6,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),f.o_(new th(tu.UNAVAILABLE,"The operation could not be completed")))}),o3(h,u.EventType.MESSAGE,t=>{if(!d){let r=t.data[0];tl(!!r,16349);let i=r?.error||r[0]?.error;if(i){tr(o6,`RPC '${e}' stream ${n} received error:`,i);let t=i.status,r=function(e){let t=m[e];if(void 0!==t)return sy(t)}(t),s=i.message;"NOT_FOUND"===t&&s.includes("database")&&s.includes("does not exist")&&s.includes(this.databaseId.database)&&ti(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),void 0===r&&(r=tu.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),d=!0,f.o_(new th(r,s)),h.close()}else tr(o6,`RPC '${e}' stream ${n} received:`,r),f.__(r)}}),o5.u_(),setTimeout(()=>{f.s_()},0),f}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return g()}}function o4(){return"u">typeof window?window:null}function o8(){return"u">typeof document?document:null}function o7(e){return new sF(e,!0)}o5.c_=!1;class o9{constructor(e,t,r=1e3,n=1.5,i=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=n,this.V_=i,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-r);n>0&&tr("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}let le="PersistentStream";class lt{constructor(e,t,r,n,i,s,a,o){this.Ci=e,this.b_=r,this.S_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new o9(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===tu.RESOURCE_EXHAUSTED?(tn(t.toString()),tn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===tu.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.D_===t&&this.G_(e,r)},t=>{e(()=>{let e=new th(tu.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return tr(le,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(tr(le,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class lr extends lt{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,i;t.targetChange;let s="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:ta(39313,{state:n}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(tl(void 0===i||"string"==typeof i,58123),ng.fromBase64String(i||"")):(tl(void 0===i||i instanceof e6.Buffer||i instanceof Uint8Array,16193),ng.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;r=new sD(s,a,o,l&&new th(void 0===l.code?tu.UNKNOWN:sy(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=sK(e,n.document.name),s=sq(n.document.updateTime),a=n.document.createTime?sq(n.document.createTime):tq.min(),o=new n1({mapValue:{fields:n.document.fields}}),l=n2.newFoundDocument(i,s,a,o);r=new sC(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=sK(e,n.document),s=n.readTime?sq(n.readTime):tq.min(),a=n2.newNoDocument(i,s);r=new sC([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=sK(e,n.document);r=new sC([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return ta(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new sg(n,i);r=new sA(e.targetId,s)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return tq.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?tq.min():t.readTime?sq(t.readTime):tq.min()}(e);return this.listener.J_(t,r)}Z_(e){let t,r={};r.database=sW(this.serializer),r.addTarget=function(e,t){let r,n=t.target;if((r=iv(n)?{documents:s1(e,n)}:{query:s2(e,n).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=sU(e,t.resumeToken);let n=sV(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(tq.min())>0){r.readTime=sB(e,t.snapshotVersion.toTimestamp());let n=sV(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let n=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ta(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});n&&(r.labels=n),this.K_(r)}X_(e){let t={};t.database=sW(this.serializer),t.removeTarget=e,this.K_(t)}}class ln extends lt{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return tl(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,tl(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,r;tl(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(tl(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?sq(e.updateTime):sq(r)).isEqual(tq.min())&&(t=sq(r)),new i8(t,e.transformResults||[])})):[]),i=sq(e.commitTime);return this.listener.na(i,n)}ra(){let e={};e.database=sW(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>sZ(this.serializer,e))};this.K_(t)}}class li{}class ls extends li{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new th(tu.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Wo(e,sz(t,r),n,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tu.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new th(tu.UNKNOWN,e.toString())})}jo(e,t,r,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.jo(e,sz(t,r),n,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tu.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new th(tu.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class la{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(tn(t),this.aa=!1):tr("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let lo="RemoteStore";class ll{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=i,this.Aa.Mo(e=>{r.enqueueAndForget(async()=>{ly(this)&&(tr(lo,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await lh(e),e.Va.set("Unknown"),e.Ea.delete(4),await lu(e)}(this))})}),this.Va=new la(r,n)}}async function lu(e){if(ly(e))for(let t of e.Ra)await t(!0)}async function lh(e){for(let t of e.Ra)await t(!1)}function lc(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),lm(e)?lg(e):lO(e).O_()&&lf(e,t))}function ld(e,t){let r=lO(e);e.Ia.delete(t),r.O_()&&lp(e,t),0===e.Ia.size&&(r.O_()?r.L_():ly(e)&&e.Va.set("Unknown"))}function lf(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(tq.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}lO(e).Z_(t)}function lp(e,t){e.da.$e(t),lO(e).X_(t)}function lg(e){e.da=new sk({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),lO(e).start(),e.Va.ua()}function lm(e){return ly(e)&&!lO(e).x_()&&e.Ia.size>0}function ly(e){return 0===e.Ea.size}async function lw(e){e.Va.set("Online")}async function lv(e){e.Ia.forEach((t,r)=>{lf(e,t)})}async function lb(e,t){e.da=void 0,lm(e)?(e.Va.ha(t),lg(e)):e.Va.set("Unknown")}async function lE(e,t,r){if(e.Va.set("Online"),t instanceof sD&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.Ia.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ia.delete(n),e.da.removeTarget(n))}(e,t)}catch(r){tr(lo,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await lI(e,r)}else if(t instanceof sC?e.da.Xe(t):t instanceof sA?e.da.st(t):e.da.tt(t),!r.isEqual(tq.min()))try{let t,n=await oT(e.localStore);r.compareTo(n)>=0&&await ((t=e.da.Tt(r)).targetChanges.forEach((t,n)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(n);i&&e.Ia.set(n,i.withResumeToken(t.resumeToken,r))}}),t.targetMismatches.forEach((t,r)=>{let n=e.Ia.get(t);if(!n)return;e.Ia.set(t,n.withResumeToken(ng.EMPTY_BYTE_STRING,n.snapshotVersion)),lp(e,t);let i=new s7(n.target,t,r,n.sequenceNumber);lf(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){tr(lo,"Failed to raise snapshot:",t),await lI(e,t)}}async function lI(e,t,r){if(!t7(t))throw t;e.Ea.add(1),await lh(e),e.Va.set("Offline"),r||(r=()=>oT(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{tr(lo,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await lu(e)})}function l_(e,t){return t().catch(r=>lI(e,r,t))}async function lT(e){var t;let r=lM(e),n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;ly(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,n);if(null===t){0===e.Ta.length&&r.L_();break}n=t.batchId,function(e,t){e.Ta.push(t);let r=lM(e);r.O_()&&r.Y_&&r.ea(t.mutations)}(e,t)}catch(t){await lI(e,t)}lS(e)&&lx(e)}function lS(e){return ly(e)&&!lM(e).x_()&&e.Ta.length>0}function lx(e){lM(e).start()}async function lC(e){lM(e).ra()}async function lA(e){let t=lM(e);for(let r of e.Ta)t.ea(r.mutations)}async function lD(e,t,r){let n=e.Ta.shift(),i=sd.from(n,t,r);await l_(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await lT(e)}async function lN(e,t){t&&lM(e).Y_&&await async function(e,t){var r;if(sm(r=t.code)&&r!==tu.ABORTED){let r=e.Ta.shift();lM(e).B_(),await l_(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await lT(e)}}(e,t),lS(e)&&lx(e)}async function lk(e,t){e.asyncQueue.verifyOperationInProgress(),tr(lo,"RemoteStore received new credentials");let r=ly(e);e.Ea.add(3),await lh(e),r&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await lu(e)}async function lR(e,t){t?(e.Ea.delete(2),await lu(e)):t||(e.Ea.add(2),await lh(e),e.Va.set("Unknown"))}function lO(e){var t,r,n;return e.ma||(t=e.datastore,r=e.asyncQueue,n={Zo:lw.bind(null,e),Yo:lv.bind(null,e),t_:lb.bind(null,e),J_:lE.bind(null,e)},t.sa(),e.ma=new lr(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.ma.B_(),lm(e)?lg(e):e.Va.set("Unknown")):(await e.ma.stop(),e.da=void 0)})),e.ma}function lM(e){var t,r,n;return e.fa||(t=e.datastore,r=e.asyncQueue,n={Zo:()=>Promise.resolve(),Yo:lC.bind(null,e),t_:lN.bind(null,e),ta:lA.bind(null,e),na:lD.bind(null,e)},t.sa(),e.fa=new ln(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.fa.B_(),await lT(e)):(await e.fa.stop(),e.Ta.length>0&&(tr(lo,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class lL{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new tc,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new lL(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new th(tu.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function lP(e,t){if(tn("AsyncQueue",`${t}: ${e}`),t7(e))return new th(tu.UNAVAILABLE,`${t}: ${e}`);throw e}class lF{static emptySet(e){return new lF(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||tN.comparator(t.key,r.key):(e,t)=>tN.comparator(e.key,t.key),this.keyedMap=iq(),this.sortedSet=new no(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof lF)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new lF;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class lV{constructor(){this.ga=new no(tN.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ta(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class lB{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new lB(e,t,lF.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&iR(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class lU{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class lq{constructor(){this.queries=lj(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new th(tu.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=lj(),t.forEach((t,r)=>{for(let t of r.ba)t.onError(e)})}}function lj(){return new iV(e=>iO(e),iR)}async function lz(e,t){let r=3,n=t.query,i=e.queries.get(n);i?!i.Sa()&&t.Da()&&(r=2):(i=new lU,r=+!t.Da());try{switch(r){case 0:i.wa=await e.onListen(n,!0);break;case 1:i.wa=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=lP(r,`Initialization of query '${iM(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.ba.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&lH(e)}async function l$(e,t){let r=t.query,n=3,i=e.queries.get(r);if(i){let e=i.ba.indexOf(t);e>=0&&(i.ba.splice(e,1),0===i.ba.length?n=+!t.Da():!i.Sa()&&t.Da()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function lG(e,t){let r=!1;for(let n of t){let t=n.query,i=e.queries.get(t);if(i){for(let e of i.ba)e.Fa(n)&&(r=!0);i.wa=n}}r&&lH(e)}function lK(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.ba)e.onError(r);e.queries.delete(t)}function lH(e){e.Ca.forEach(e=>{e.next()})}(v=w||(w={})).Ma="default",v.Cache="cache";class lQ{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new lB(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.Ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=lB.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==w.Cache}}class lW{constructor(e,t){this.qa=e,this.byteLength=t}Ua(){return"metadata"in this.qa}}class lJ{constructor(e){this.serializer=e}Ks(e){return sK(this.serializer,e)}qs(e){return e.metadata.exists?sX(this.serializer,e.document,!1):n2.newNoDocument(this.Ks(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return sq(e)}}class lY{constructor(e,t){this.$a=e,this.serializer=t,this.Wa=[],this.Qa=[],this.collectionGroups=new Set,this.progress=lX(e)}get queries(){return this.Wa}get documents(){return this.Qa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Wa.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Qa.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let r=tC.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Qa[this.Qa.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,r=new lJ(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.Ks(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||iK()).add(e);t.set(r,n)}}return t}async ja(e){let t=await oR(e,new lJ(this.serializer),this.Qa,this.$a.id),r=this.za(this.documents);for(let t of this.Wa)await oO(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ha:this.collectionGroups,Ja:t}}}function lX(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class lZ{constructor(e){this.key=e}}class l0{constructor(e){this.key=e}}class l1{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=iK(),this.mutatedKeys=iK(),this.eu=iF(e),this.tu=new lF(this.eu)}get nu(){return this.Za}ru(e,t){let r=t?t.iu:new lV,n=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),h=iL(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(r.track({type:3,doc:h}),f=!0):this.su(u,h)||(r.track({type:2,doc:h}),f=!0,(o&&this.eu(h,o)>0||l&&0>this.eu(h,l))&&(a=!0)):!u&&h?(r.track({type:0,doc:h}),f=!0):u&&!h&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{tu:s,iu:r,Ss:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var r,n;let i;return r=e.type,n=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ta(20277,{Vt:e})}})(r)-i(n)||this.eu(e.doc,t.doc)}),this.ou(r),n=n??!1;let a=t&&!n?this._u():[],o=0===this.Ya.size&&this.current&&!n?1:0,l=o!==this.Xa;return(this.Xa=o,0!==s.length||l)?{snapshot:new lB(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new lV,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=iK(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});let t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new l0(e))}),this.Ya.forEach(r=>{e.has(r)||t.push(new lZ(r))}),t}cu(e){this.Za=e.ks,this.Ya=iK();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return lB.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}let l2="SyncEngine";class l6{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class l3{constructor(e){this.key=e,this.hu=!1}}class l5{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new iV(e=>iO(e),iR),this.Iu=new Map,this.Eu=new Set,this.Ru=new no(tN.comparator),this.Au=new Map,this.Vu=new or,this.du={},this.mu=new Map,this.fu=aG.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function l4(e,t,r=!0){let n,i=ux(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.lu()):n=await l7(i,t,r,!0),n}async function l8(e,t){let r=ux(e);await l7(r,t,!0,!1)}async function l7(e,t,r,n){let i,s=await ox(e.localStore,iA(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await l9(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&lc(e.remoteStore,s),i}async function l9(e,t,r,n,i){e.pu=(t,r,n)=>(async function(e,t,r,n){let i=t.view.ru(r);i.Ss&&(i=await oA(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return ud(e,t.targetId,o.au),o.snapshot})(e,t,r,n);let s=await oA(e.localStore,t,!0),a=new l1(t,s.ks),o=a.ru(s.documents),l=sx.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);ud(e,r,u.au);let h=new l6(t,r,a);return e.Tu.set(t,h),e.Iu.has(r)?e.Iu.get(r).push(t):e.Iu.set(r,[t]),u.snapshot}async function ue(e,t,r){let n=e.Tu.get(t),i=e.Iu.get(n.targetId);i.length>1?(e.Iu.set(n.targetId,i.filter(e=>!iR(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await oC(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&ld(e.remoteStore,n.targetId),uh(e,n.targetId)}).catch(t0)):(uh(e,n.targetId),await oC(e.localStore,n.targetId,!0))}async function ut(e,t){let r=e.Tu.get(t),n=e.Iu.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),ld(e.remoteStore,r.targetId))}async function ur(e,t,r){let n=uC(e);try{var i,s;let e,a,o,l,u,h=await (i=n.localStore,o=tU.now(),l=t.reduce((e,t)=>e.add(t.key),iK()),i.persistence.runTransaction("Locally write mutations","readwrite",r=>{let n=iB,s=iK();return i.xs.getEntries(r,l).next(e=>{(n=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(r,n)).next(n=>{e=n;let s=[];for(let r of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=iY(n.transform,e||null);null!=i&&(null===r&&(r=n1.empty()),r.set(n.field,i))}return r||null}(r,e.get(r.key).overlayedDocument);null!=t&&s.push(new ss(r.key,t,function e(t){let r=[];return ns(t.fields,(t,n)=>{let i=new tD([t]);if(nQ(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(i);else for(let e of t)r.push(i.child(e))}else r.push(i)}),new nf(r)}(t.value.mapValue),i7.exists(!0)))}return i.mutationQueue.addMutationBatch(r,o,s,t)}).next(t=>{a=t;let n=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(r,t.batchId,n)})}).then(()=>({batchId:a.batchId,changes:ij(e)})));n.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=n.du[n.currentUser.toKey()])||(u=new no(tE)),u=u.insert(s,r),n.du[n.currentUser.toKey()]=u,await up(n,h.changes),await lT(n.remoteStore)}catch(t){let e=lP(t,"Failed to persist write");r.reject(e)}}async function un(e,t){var r;try{let n,i,s=await (r=e.localStore,n=t.snapshotVersion,i=r.vs,r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.xs.newChangeBuffer({trackRemovals:!0});i=r.vs;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(r.li.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.li.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(ng.EMPTY_BYTE_STRING,tq.min()).withLastLimboFreeSnapshotVersion(tq.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(r.li.updateTargetData(e,h))});let o=iB,l=iK();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(oS(e,s,t.documentUpdates).next(e=>{o=e.Bs,l=e.Ls})),!n.isEqual(tq.min())){let t=r.li.getLastRemoteSnapshotVersion(e).next(t=>r.li.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return t1.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.vs=i,e)));t.targetChanges.forEach((t,r)=>{let n=e.Au.get(r);n&&(tl(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?n.hu=!0:t.modifiedDocuments.size>0?tl(n.hu,14607):t.removedDocuments.size>0&&(tl(n.hu,42227),n.hu=!1))}),await up(e,s,t)}catch(e){await t0(e)}}function ui(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,i=[];e.Tu.forEach((e,r)=>{let n=r.view.va(t);n.snapshot&&i.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.ba)e.va(t)&&(r=!0)}),r&&lH(n),i.length&&e.Pu.J_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function us(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Au.get(t),i=n&&n.key;if(i){let r=new no(tN.comparator);r=r.insert(i,n2.newNoDocument(i,tq.min()));let n=iK().add(i),s=new sS(tq.min(),new Map,new no(tE),r,n);await un(e,s),e.Ru=e.Ru.remove(i),e.Au.delete(t),uf(e)}else await oC(e.localStore,t,!1).then(()=>uh(e,t,r)).catch(t0)}async function ua(e,t){var r;let n=t.batch.batchId;try{let i=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n,i,s,a=t.batch.keys(),o=r.xs.newChangeBuffer({trackRemovals:!0});return(i=(n=t.batch).keys(),s=t1.resolve(),i.forEach(r=>{s=s.next(()=>o.getEntry(e,r)).next(e=>{let i=t.docVersions.get(r);tl(null!==i,48541),0>e.version.compareTo(i)&&(n.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>r.mutationQueue.removeMutationBatch(e,n))).next(()=>o.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=iK();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,a))}));uu(e,n,null),ul(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await up(e,i)}catch(e){await t0(e)}}async function uo(e,t,r){var n;try{let i=await (n=e.localStore,n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(tl(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))}));uu(e,t,r),ul(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await up(e,i)}catch(e){await t0(e)}}function ul(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function uu(e,t,r){let n=e.du[e.currentUser.toKey()];if(n){let i=n.get(t);i&&(r?i.reject(r):i.resolve(),n=n.remove(t)),e.du[e.currentUser.toKey()]=n}}function uh(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(n),r&&e.Pu.yu(n,r);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||uc(e,t)})}function uc(e,t){e.Eu.delete(t.path.canonicalString());let r=e.Ru.get(t);null!==r&&(ld(e.remoteStore,r),e.Ru=e.Ru.remove(t),e.Au.delete(r),uf(e))}function ud(e,t,r){for(let n of r)n instanceof lZ?(e.Vu.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.Ru.get(r)||e.Eu.has(n)||(tr(l2,"New document in limbo: "+r),e.Eu.add(n),uf(e))}(e,n)):n instanceof l0?(tr(l2,"Document no longer in limbo: "+n.key),e.Vu.removeReference(n.key,t),e.Vu.containsKey(n.key)||uc(e,n.key)):ta(19791,{wu:n})}function uf(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let r=new tN(tC.fromString(t)),n=e.fu.next();e.Au.set(n,new l3(r)),e.Ru=e.Ru.insert(r,n),lc(e.remoteStore,new s7(iA(iT(r.path)),n,"TargetPurposeLimboResolution",ra.ce))}}async function up(e,t,r){let n=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,r).then(t=>{if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:r?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){n.push(t);let e=ow.Es(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.J_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>t1.forEach(t,t=>t1.forEach(t.Ts,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>t1.forEach(t.Is,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!t7(e))throw e;tr(oE,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.vs.get(t),n=r.snapshotVersion,i=r.withLastLimboFreeSnapshotVersion(n);e.vs=e.vs.insert(t,i)}}}(e.localStore,i))}async function ug(e,t){if(!e.currentUser.isEqual(t)){tr(l2,"User change. New user:",t.toKey());let r=await o_(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new th(tu.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await up(e,r.Ns)}}function um(e,t){let r=e.Au.get(t);if(r&&r.hu)return iK().add(r.key);{let r=iK(),n=e.Iu.get(t);if(!n)return r;for(let t of n){let n=e.Tu.get(t);r=r.unionWith(n.view.nu)}return r}}async function uy(e,t){let r=await oA(e.localStore,t.query,!0),n=t.view.cu(r);return e.isPrimaryClient&&ud(e,t.targetId,n.au),n}async function uw(e,t){return oN(e.localStore,t).then(t=>up(e,t))}async function uv(e,t,r,n){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.Xn(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):t1.resolve(null))));null!==o?("pending"===r?await lT(e.remoteStore):"acknowledged"===r||"rejected"===r?(uu(e,t,n||null),ul(e,t),s=e.localStore,s.mutationQueue.nr(t)):ta(6720,"Unknown batchState",{bu:r}),await up(e,o)):tr(l2,"Cannot apply mutation batch with id: "+t)}async function ub(e,t){if(ux(e),uC(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),r=await uE(e,t.toArray());for(let t of(e.gu=!0,await lR(e.remoteStore,!0),r))lc(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],r=Promise.resolve();e.Iu.forEach((n,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):r=r.then(()=>(uh(e,i),oC(e.localStore,i,!0))),ld(e.remoteStore,i)}),await r,await uE(e,t),e.Au.forEach((t,r)=>{ld(e.remoteStore,r)}),e.Vu.zr(),e.Au=new Map,e.Ru=new no(tN.comparator),e.gu=!1,await lR(e.remoteStore,!1)}}async function uE(e,t,r){let n=[],i=[];for(let r of t){let t,s=e.Iu.get(r);if(s&&0!==s.length)for(let r of(t=await ox(e.localStore,iA(s[0])),s)){let t=e.Tu.get(r),n=await uy(e,t);n.snapshot&&i.push(n.snapshot)}else{let n=await oD(e.localStore,r);t=await ox(e.localStore,n),await l9(e,uI(n),r,!1,t.resumeToken)}n.push(t)}return e.Pu.J_(i),n}function uI(e){var t,r,n,i,s;return t=e.path,r=e.collectionGroup,n=e.orderBy,i=e.filters,s=e.limit,new i_(t,r,n,i,s,"F",e.startAt,e.endAt)}function u_(e){return e.localStore.persistence.hs()}async function uT(e,t,r,n){if(e.gu)return void tr(l2,"Ignoring unexpected query state notification.");let i=e.Iu.get(t);if(i&&i.length>0)switch(r){case"current":case"not-current":{let n=await oN(e.localStore,iP(i[0])),s=sS.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,ng.EMPTY_BYTE_STRING);await up(e,n,s);break}case"rejected":await oC(e.localStore,t,!0),uh(e,t,n);break;default:ta(64155,r)}}async function uS(e,t,r){let n=ux(e);if(n.gu){for(let e of t){if(n.Iu.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){tr(l2,"Adding an already active target "+e);continue}let t=await oD(n.localStore,e),r=await ox(n.localStore,t);await l9(n,uI(t),r.targetId,!1,r.resumeToken),lc(n.remoteStore,r)}for(let e of r)n.Iu.has(e)&&await oC(n.localStore,e,!1).then(()=>{ld(n.remoteStore,e),uh(n,e)}).catch(t0)}}function ux(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=un.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=um.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=us.bind(null,e),e.Pu.J_=lG.bind(null,e.eventManager),e.Pu.yu=lK.bind(null,e.eventManager),e}function uC(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=ua.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=uo.bind(null,e),e}class uA{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=o7(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,r;return t=this.persistence,r=new ob,new oI(t,r,e.initialUser,this.serializer)}Cu(e){return new ol(oh.Vi,this.serializer)}Du(e){return new oH}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}uA.provider={build:()=>new uA};class uD extends uA{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return tl(this.persistence.referenceDelegate instanceof oc,46915),new aY(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?aB.withCacheSize(this.cacheSizeBytes):aB.DEFAULT;return new ol(e=>oc.Vi(e,t),this.serializer)}}class uN extends uA{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await uC(this.xu.syncEngine),await lT(this.xu.remoteStore),await this.persistence.zi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,r;return t=this.persistence,r=new ob,new oI(t,r,e.initialUser,this.serializer)}Fu(e,t){return new aY(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let r=new rs(t,this.persistence);return new ri(e.asyncQueue,r)}Cu(e){let t=oy(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?aB.withCacheSize(this.cacheSizeBytes):aB.DEFAULT;return new om(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,o4(),o8(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new oH}}class uk extends uN{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof oK&&(this.sharedClientState.syncEngine={So:uv.bind(null,t),Do:uT.bind(null,t),Co:uS.bind(null,t),hs:u_.bind(null,t),bo:uw.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi(async e=>{await ub(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=o4();if(!oK.v(t))throw new th(tu.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=oy(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new oK(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class uR{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>ui(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=ug.bind(null,this.syncEngine),await lR(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new lq}createDatastore(e){var t;let r=o7(e.databaseInfo.databaseId),n=new o5(e.databaseInfo);return t=e.authCredentials,new ls(t,e.appCheckCredentials,n,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new ll(t,r,e.asyncQueue,e=>ui(this.syncEngine,e,0),oJ.v()?new oJ:new oQ)}createSyncEngine(e,t){var r,n,i,s,a,o;let l;return r=this.localStore,n=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new l5(r,n,i,s,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){tr(lo,"RemoteStore shutting down."),e.Ea.add(5),await lh(e),e.Aa.shutdown(),e.Va.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}function uO(e,t=10240){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}uR.provider={build:()=>new uR};class uM{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):tn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class uL{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new tc,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.Ua()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.Ku();if(null===e)return null;let t=this.Lu.decode(e),r=Number(t);return isNaN(r)&&this.qu(`length string (${t}) is not valid number`),new lW(JSON.parse(await this.Uu(r)),e.length+r)}$u(){return this.buffer.findIndex(e=>123===e)}async Ku(){for(;0>this.$u()&&!await this.Wu(););if(0===this.buffer.length)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Uu(e){for(;this.buffer.length<e;)await this.Wu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Bu.cancel(),Error(`Invalid bundle format: ${e}`)}async Wu(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class uP{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.Su();if(!r||!r.Ua())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.qa)}`);this.metadata=r;do null!==(r=this.Su())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}Qu(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.Ku();return new lW(JSON.parse(this.Uu(e)),e)}Uu(e){if(this.cursor+e>this.bundleData.length)throw new th(tu.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}Ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class uF{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new th(tu.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let r={documents:t.map(t=>sG(e.serializer,t))},n=await e.jo("BatchGetDocuments",e.serializer.databaseId,tC.emptyPath(),r,t.length),i=new Map;n.forEach(t=>{var r;let n,s,a,o,l,u,h=(r=e.serializer,"found"in t?(tl(!!t.found,43571),t.found.name,t.found.updateTime,n=sK(r,t.found.name),s=sq(t.found.updateTime),a=t.found.createTime?sq(t.found.createTime):tq.min(),o=new n1({mapValue:{fields:t.found.fields}}),n2.newFoundDocument(n,s,a,o)):"missing"in t?(tl(!!t.missing,3894),tl(!!t.readTime,22933),l=sK(r,t.missing),u=sq(t.readTime),n2.newNoDocument(l,u)):ta(7234,{result:t}));i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());tl(!!t,55234,{key:e}),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new su(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=tN.fromPath(t);this.mutations.push(new sh(r,this.precondition(r)))}),await async function(e,t){let r={writes:t.map(t=>sZ(e.serializer,t))};await e.Wo("Commit",e.serializer.databaseId,tC.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ta(50498,{Gu:e.constructor.name});t=tq.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new th(tu.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(tq.min())?i7.exists(!1):i7.updateTime(t):i7.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(tq.min()))throw new th(tu.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return i7.updateTime(t)}return i7.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class uV{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.zu=r.maxAttempts,this.M_=new o9(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_(async()=>{let e=new uF(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Zu(e)}))}).catch(e=>{this.Zu(e)})})}Ju(e){try{let t=this.updateFunction(e);return!ro(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Zu(e){this.zu>0&&this.Xu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Hu(),Promise.resolve()))):this.deferred.reject(e)}Xu(e){if("FirebaseError"===e?.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!sm(t)}return!1}}let uB="FirestoreClient";class uU{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=n,this.user=e7.UNAUTHENTICATED,this.clientId=tb.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{tr(uB,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(tr(uB,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new tc;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=lP(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function uq(e,t){e.asyncQueue.verifyOperationInProgress(),tr(uB,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await o_(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function uj(e,t){e.asyncQueue.verifyOperationInProgress();let r=await uz(e);tr(uB,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>lk(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>lk(t.remoteStore,r)),e._onlineComponents=t}async function uz(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){tr(uB,"Using user provided OfflineComponentProvider");try{await uq(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===tu.FAILED_PRECONDITION||t.code===tu.UNIMPLEMENTED:!("u">typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;ti("Error using user provided cache. Falling back to memory cache: "+t),await uq(e,new uA)}}else tr(uB,"Using default OfflineComponentProvider"),await uq(e,new uD(void 0));return e._offlineComponents}async function u$(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(tr(uB,"Using user provided OnlineComponentProvider"),await uj(e,e._uninitializedComponentsProvider._online)):(tr(uB,"Using default OnlineComponentProvider"),await uj(e,new uR))),e._onlineComponents}function uG(e){return uz(e).then(e=>e.localStore)}function uK(e){return u$(e).then(e=>e.syncEngine)}function uH(e){return u$(e).then(e=>e.datastore)}async function uQ(e){let t=await u$(e),r=t.eventManager;return r.onListen=l4.bind(null,t.syncEngine),r.onUnlisten=ue.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=l8.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=ut.bind(null,t.syncEngine),r}function uW(e,t,r={}){let n=new tc;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await uQ(e),s=e.asyncQueue,a=new uM({next:e=>{a.Nu(),s.enqueueAndForget(()=>l$(i,o));let l=e.docs.has(t);!l&&e.fromCache?n.reject(new th(tu.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&r&&"server"===r.source?n.reject(new th(tu.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):n.resolve(e)},error:e=>n.reject(e)}),lz(i,o=new lQ(iT(t.path),a,{includeMetadataChanges:!0,Ka:!0}))}),n.promise}function uJ(e,t,r={}){let n=new tc;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await uQ(e),s=e.asyncQueue,o=new lQ(t,a=new uM({next:e=>{a.Nu(),s.enqueueAndForget(()=>l$(i,o)),e.fromCache&&"server"===r.source?n.reject(new th(tu.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):n.resolve(e)},error:e=>n.reject(e)}),{includeMetadataChanges:!0,Ka:!0}),lz(i,o)}),n.promise}function uY(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let uX=new Map,uZ="firestore.googleapis.com";class u0{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new th(tu.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=uZ,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new th(tu.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new th(tu.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=uY(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new th(tu.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new th(tu.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new th(tu.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class u1{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new u0({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new th(tu.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new th(tu.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new u0(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new tf;switch(e.type){case"firstParty":return new ty(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new th(tu.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=uX.get(this))&&(tr("ComponentProvider","Removing Datastore"),uX.delete(this),e.terminate()),Promise.resolve()}}class u2{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new u2(this.firestore,e,this._query)}}class u6{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new u3(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new u6(this.firestore,e,this._key)}toJSON(){return{type:u6._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(tB(t,u6._jsonSchema))return new u6(e,r||null,new tN(tC.fromString(t.referencePath)))}}u6._jsonSchemaVersion="firestore/documentReference/1.0",u6._jsonSchema={type:tV("string",u6._jsonSchemaVersion),referencePath:tV("string")};class u3 extends u2{constructor(e,t,r){super(e,t,iT(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new u6(this.firestore,null,new tN(e))}withConverter(e){return new u3(this.firestore,e,this._path)}}function u5(e,t,...r){if(e=H(e),tk("collection","path",t),e instanceof u1){let n=tC.fromString(t,...r);return tO(n),new u3(e,null,n)}{if(!(e instanceof u6||e instanceof u3))throw new th(tu.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(tC.fromString(t,...r));return tO(n),new u3(e.firestore,null,n)}}function u4(e,t,...r){if(e=H(e),1==arguments.length&&(t=tb.newId()),tk("doc","path",t),e instanceof u1){let n=tC.fromString(t,...r);return tR(n),new u6(e,null,new tN(n))}{if(!(e instanceof u6||e instanceof u3))throw new th(tu.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(tC.fromString(t,...r));return tR(n),new u6(e.firestore,e instanceof u3?e.converter:null,new tN(n))}}function u8(e,t){return e=H(e),t=H(t),e instanceof u2&&t instanceof u2&&e.firestore===t.firestore&&iR(e._query,t._query)&&e.converter===t.converter}let u7="AsyncQueue";class u9{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new o9(this,"async_queue_retry"),this._c=()=>{let e=o8();e&&tr(u7,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=o8();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=o8();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new tc;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!t7(e))throw e;tr(u7,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,tn("INTERNAL UNHANDLED ERROR: ",he(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let n=lL.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(n),n}uc(){this.nc&&ta(47125,{Pc:he(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function he(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class ht{constructor(){this._progressObserver={},this._taskCompletionResolver=new tc,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class hr extends u1{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new u9,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new u9(e),this._firestoreClient=void 0,await e}}}function hn(e,t){let r=eA("object"==typeof e?e:eq(),"firestore").getImmediate({identifier:"string"==typeof e?e:t||nA});if(!r._initialized){let e=(e=>{let t=D()?.emulatorHosts?.[e];if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]})("firestore");e&&function(e,t,r,n={}){e=tP(e,u1);let i=R(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&(O(`https://${o}`),function(e,t){if("u"<typeof window||"u"<typeof document||!R(window.location.host)||M[e]===t||M[e]||L)return;function r(e){return`__firebase__banner__${e}`}M[e]=t;let n="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(M))M[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(n),t=!1,e||((e=document.createElement("div")).setAttribute("id",n),t=!0),{created:t,element:e}),a=r("text"),o=document.getElementById(a)||document.createElement("span"),l=r("learnmore"),u=document.getElementById(l)||document.createElement("a"),h=r("preprendIcon"),c=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let r=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;L=!0,(e=document.getElementById(n))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",h),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,o,u,r),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}("Firestore",!0)),s.host!==uZ&&s.host!==o&&ti("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!G(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=e7.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[x(JSON.stringify({alg:"none",type:"JWT"})),x(JSON.stringify(s)),""].join(".")}(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new th(tu.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new e7(i)}e._authCredentials=new tp(new td(t,r))}}(r,...e)}return r}function hi(e){if(e._terminated)throw new th(tu.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,r,n,i,s;let a,o=e._freezeSettings(),l=(t=e._databaseId,r=e._app?.options.appId||"",n=e._persistenceKey,i=e._app?.options.apiKey,new nC(t,r,n,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,uY(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator,i));e._componentsProvider||o.localCache?._offlineComponentProvider&&o.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),e._firestoreClient=new uU(e._authCredentials,e._appCheckCredentials,e._queue,l,e._componentsProvider&&(s=e._componentsProvider,a=s?._online.build(),{_offline:s?._offline.build(a),_online:a}))}(e),e._firestoreClient}function hs(e,t){let r=hi(e=tP(e,hr)),n=new ht;return function(e,t,r,n){var i;let s=(i=o7(t),new uL(function(e,t){if(e instanceof Uint8Array)return uO(e,void 0);if(e instanceof ArrayBuffer)return uO(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof r?sv().encode(r):r),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,r){try{var n,i;let s,a=await t.getMetadata();if(await (n=e.localStore,s=sq(a.createTime),n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Pi.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),r._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);r._updateProgress(lX(a));let o=new lY(a,t.serializer),l=await t.Su();for(;l;){let e=await o.Ga(l);e&&r._updateProgress(e),l=await t.Su()}let u=await o.ja(e.localStore);return await up(e,u.Ja,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.Pi.saveBundleMetadata(e,a))),r._completeWith(u.progress),Promise.resolve(u.Ha)}catch(e){return ti(l2,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}})(t=await uK(e),s,n).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(r,e._databaseId,t,n),n}class ha{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ha(ng.fromBase64String(e))}catch(e){throw new th(tu.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new ha(ng.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:ha._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(tB(e,ha._jsonSchema))return ha.fromBase64String(e.bytes)}}ha._jsonSchemaVersion="firestore/bytes/1.0",ha._jsonSchema={type:tV("string",ha._jsonSchemaVersion),bytes:tV("string")};class ho{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new th(tu.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new tD(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class hl{constructor(e){this._methodName=e}}class hu{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new th(tu.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new th(tu.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return tE(this._lat,e._lat)||tE(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:hu._jsonSchemaVersion}}static fromJSON(e){if(tB(e,hu._jsonSchema))return new hu(e.latitude,e.longitude)}}hu._jsonSchemaVersion="firestore/geoPoint/1.0",hu._jsonSchema={type:tV("string",hu._jsonSchemaVersion),latitude:tV("number"),longitude:tV("number")};class hh{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:hh._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(tB(e,hh._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new hh(e.vectorValues);throw new th(tu.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}hh._jsonSchemaVersion="firestore/vectorValue/1.0",hh._jsonSchema={type:tV("string",hh._jsonSchemaVersion),vectorValues:tV("object")};let hc=/^__.*__$/;class hd{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new ss(e,this.data,this.fieldMask,t,this.fieldTransforms):new si(e,this.data,t,this.fieldTransforms)}}class hf{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ss(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function hp(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ta(40011,{dataSource:e})}}class hg{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new hg({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return hN(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(hp(this.dataSource)&&hc.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class hm{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||o7(e)}createContext(e,t,r,n=!1){return new hg({dataSource:e,methodName:t,targetDoc:r,path:tD.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function hy(e){let t=e._freezeSettings(),r=o7(e._databaseId);return new hm(e._databaseId,!!t.ignoreUndefinedProperties,r)}function hw(e,t,r,n,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);hx("Data must be an object, but it was:",l,n);let u=hT(n,l);if(s.merge)a=new nf(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=hC(t,n,r);if(!l.contains(i))throw new th(tu.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);hk(e,i)||e.push(i)}a=new nf(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new hd(new n1(u),a,o)}class hv extends hl{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof hv}}function hb(e,t,r,n){let i=e.createContext(1,t,r);hx("Data must be an object, but it was:",i,n);let s=[],a=n1.empty();return ns(n,(e,n)=>{let o=hD(t,e,r);n=H(n);let l=i.childContextForFieldPath(o);if(n instanceof hv)s.push(o);else{let e=h_(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new hf(a,new nf(s),i.fieldTransforms)}function hE(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[hC(t,n,r)],l=[i];if(s.length%2!=0)throw new th(tu.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(hC(t,s[e])),l.push(s[e+1]);let u=[],h=n1.empty();for(let e=o.length-1;e>=0;--e)if(!hk(u,o[e])){let t=o[e],r=l[e];r=H(r);let n=a.childContextForFieldPath(t);if(r instanceof hv)u.push(t);else{let e=h_(r,n);null!=e&&(u.push(t),h.set(t,e))}}return new hf(h,new nf(u),a.fieldTransforms)}function hI(e,t,r,n=!1){return h_(r,e.createContext(n?4:3,t))}function h_(e,t){if(hS(e=H(e)))return hx("Unsupported field value:",t,e),hT(e,t);if(e instanceof hl)return function(e,t){if(!hp(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");let r=[],n=0;for(let i of e){let e=h_(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}return function(e,t){var r,n,i;if(null===(e=H(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return r=t.serializer,ru(n=e)?iW(n):iQ(r,n);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=tU.fromDate(e);return{timestampValue:sB(t.serializer,r)}}if(e instanceof tU){let r=new tU(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:sB(t.serializer,r)}}if(e instanceof hu)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof ha)return{bytesValue:sU(t.serializer,e._byteString)};if(e instanceof u6){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:sj(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof hh)return{mapValue:{fields:{[nN]:{stringValue:nO},[nM]:{arrayValue:{values:((i=e)instanceof hh?i.toArray():i).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return iQ(t.serializer,e)})}}}}};if(s8(e))return e._toProto(t.serializer);throw t.createError(`Unsupported field value: ${tL(e)}`)}(e,t)}function hT(e,t){let r={};return na(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ns(e,(e,n)=>{let i=h_(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function hS(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof tU||e instanceof hu||e instanceof ha||e instanceof u6||e instanceof hl||e instanceof hh||s8(e))}function hx(e,t,r){if(!hS(r)||!tM(r)){let n=tL(r);throw"an object"===n?t.createError(e+" a custom object"):t.createError(e+" "+n)}}function hC(e,t,r){if((t=H(t))instanceof ho)return t._internalPath;if("string"==typeof t)return hD(e,t);throw hN("Field path arguments must be of type string or ",e,!1,void 0,r)}let hA=RegExp("[~\\*/\\[\\]]");function hD(e,t,r){if(t.search(hA)>=0)throw hN(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new ho(...t.split("."))._internalPath}catch(n){throw hN(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function hN(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new th(tu.INVALID_ARGUMENT,o+e+l)}function hk(e,t){return e.some(e=>e.isEqual(t))}class hR{convertValue(e,t="none"){switch(nP(e)){case 0:return null;case 1:return e.booleanValue;case 2:return nw(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nv(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ta(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return ns(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new hh(e.fields?.[nM].arrayValue?.values?.map(e=>nw(e.doubleValue)))}convertGeoPoint(e){return new hu(nw(e.latitude),nw(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=nS(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(nx(e));default:return null}}convertTimestamp(e){let t=ny(e);return new tU(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=tC.fromString(e);tl(s4(r),9688,{name:e});let n=new nD(r.get(1),r.get(3)),i=new tN(r.popFirst(5));return n.isEqual(t)||tn(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class hO extends hR{constructor(e){super(),this.firestore=e}convertBytes(e){return new ha(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new u6(this.firestore,null,t)}}let hM="@firebase/firestore",hL="4.11.0";function hP(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class hF{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class hV{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new n1({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class hB{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new u6(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new hU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(hC("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class hU extends hB{data(){return super.data()}}function hq(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new th(tu.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class hj{}class hz extends hj{}function h$(e,t,...r){let n=[];for(let i of(t instanceof hj&&n.push(t),function(e){let t=e.filter(e=>e instanceof hH).length,r=e.filter(e=>e instanceof hG).length;if(t>1||t>0&&r>0)throw new th(tu.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(r)),n))e=i._apply(e);return e}class hG extends hz{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new hG(e,t,r)}_apply(e){let t=this._parse(e);return ce(e._query,t),new u2(e.firestore,e.converter,iN(e._query,t))}_parse(e){let t=hy(e.firestore);return function(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new th(tu.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){h9(a,s);let t=[];for(let r of a)t.push(h7(n,e,r));o={arrayValue:{values:t}}}else o=h7(n,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||h9(a,s),o=hI(r,t,a,"in"===s||"not-in"===s);return n7.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function hK(e,t,r){let n=hC("where",e);return hG._create(n,t,r)}class hH extends hj{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new hH(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:n9.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())ce(r,e),r=iN(r,e)}(e._query,t),new u2(e.firestore,e.converter,iN(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function hQ(...e){return e.forEach(e=>ct("or",e)),hH._create("or",e)}function hW(...e){return e.forEach(e=>ct("and",e)),hH._create("and",e)}class hJ extends hz{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new hJ(e,t)}_apply(e){var t;let r,n=function(e,t,r){if(null!==e.startAt)throw new th(tu.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new th(tu.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new n4(t,r)}(e._query,this._field,this._direction);return new u2(e.firestore,e.converter,(t=e._query,r=t.explicitOrderBy.concat([n]),new i_(t.path,t.collectionGroup,r,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function hY(e,t="asc"){let r=hC("orderBy",e);return hJ._create(r,t)}class hX extends hz{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new hX(e,t,r)}_apply(e){return new u2(e.firestore,e.converter,ik(e._query,this._limit,this._limitType))}}function hZ(e){return tF("limit",e),hX._create("limit",e,"F")}function h0(e){return tF("limitToLast",e),hX._create("limitToLast",e,"L")}class h1 extends hz{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new h1(e,t,r)}_apply(e){var t;let r=h8(e,this.type,this._docOrFields,this._inclusive);return new u2(e.firestore,e.converter,(t=e._query,new i_(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,r,t.endAt)))}}function h2(...e){return h1._create("startAt",e,!0)}function h6(...e){return h1._create("startAfter",e,!1)}class h3 extends hz{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new h3(e,t,r)}_apply(e){var t;let r=h8(e,this.type,this._docOrFields,this._inclusive);return new u2(e.firestore,e.converter,(t=e._query,new i_(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,r)))}}function h5(...e){return h3._create("endBefore",e,!1)}function h4(...e){return h3._create("endAt",e,!0)}function h8(e,t,r,n){if(r[0]=H(r[0]),r[0]instanceof hB)return function(e,t,r,n,i){if(!n)throw new th(tu.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of iC(e))if(r.field.isKeyField())s.push(nz(t,n.key));else{let e=n.data.field(r.field);if(nT(e))throw new th(tu.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=r.field.canonicalString();throw new th(tu.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new n6(s,i)}(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=hy(e.firestore);return function(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new th(tu.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new th(tu.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!ix(e)&&-1!==l.indexOf("/"))throw new th(tu.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(tC.fromString(l));if(!tN.isDocumentKey(r))throw new th(tu.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new tN(r);o.push(nz(t,i))}else{let e=hI(r,n,l);o.push(e)}}return new n6(o,s)}(e._query,e.firestore._databaseId,i,t,r,n)}}function h7(e,t,r){if("string"==typeof(r=H(r))){if(""===r)throw new th(tu.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ix(t)&&-1!==r.indexOf("/"))throw new th(tu.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(tC.fromString(r));if(!tN.isDocumentKey(n))throw new th(tu.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return nz(e,new tN(n))}if(r instanceof u6)return nz(e,r._key);throw new th(tu.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${tL(r)}.`)}function h9(e,t){if(!Array.isArray(e)||0===e.length)throw new th(tu.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function ce(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new th(tu.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new th(tu.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function ct(e,t){if(!(t instanceof hG||t instanceof hH))throw new th(tu.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function cr(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class cn extends hR{constructor(e){super(),this.firestore=e}convertBytes(e){return new ha(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new u6(this.firestore,null,t)}}function ci(e){return new hF("sum",hC("sum",e))}function cs(e){return new hF("avg",hC("average",e))}function ca(){return new hF("count")}function co(e,t){return e instanceof hF&&t instanceof hF&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function cl(e,t){return u8(e.query,t.query)&&G(e.data(),t.data())}function cu(e){return ch(e,{count:ca()})}function ch(e,t){var r;let n,i=tP(e.firestore,hr),s=hi(i),a=function(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}(t,(e,t)=>new sp(t,e.aggregateType,e._internalFieldPath));return(r=e._query,n=new tc,s.asyncQueue.enqueueAndForget(async()=>{try{let e=await uH(s);n.resolve(async function(e,t,r){let{request:n,gt:i,parent:s}=function(e,t,r,n){let{ft:i,parent:s}=s2(e,t),a={},o=[],l=0;return r.forEach(e=>{let t="aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:s3(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:s3(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},gt:a,parent:s}}(e.serializer,(t.Re||(t.Re=iD(t,t.explicitOrderBy)),t.Re),r);e.connection.Ko||delete n.parent;let a=(await e.jo("RunAggregationQuery",e.serializer.databaseId,s,n,1)).filter(e=>!!e.result);tl(1===a.length,64727);let o=a[0].result?.aggregateFields;return Object.keys(o).reduce((e,t)=>(e[i[t]]=o[t],e),{})}(e,r,a))}catch(e){n.reject(e)}}),n.promise).then(t=>new hV(e,new hO(i),t))}class cc{constructor(e){this.kind="memory",this._onlineComponentProvider=uR.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new uD(void 0)}}toJSON(){return{kind:this.kind}}}class cd{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=cE(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class cf{constructor(){this.kind="memoryEager",this._offlineComponentProvider=uA.provider}toJSON(){return{kind:this.kind}}}class cp{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new uD(e)}}toJSON(){return{kind:this.kind}}}function cg(){return new cf}function cm(e){return new cp(e?.cacheSizeBytes)}function cy(e){return new cc(e)}function cw(e){return new cd(e)}class cv{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=uR.provider,this._offlineComponentProvider={build:t=>new uN(t,e?.cacheSizeBytes,this.forceOwnership)}}}class cb{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=uR.provider,this._offlineComponentProvider={build:t=>new uk(t,e?.cacheSizeBytes)}}}function cE(e){return new cv(e?.forceOwnership)}function cI(){return new cb}let c_="NOT SUPPORTED";class cT{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class cS extends hB{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new cC(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(hC("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new th(tu.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=cS._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function cx(e,t,r){if(tB(t,cS._jsonSchema)){var n;if(t.bundle===c_)throw new th(tu.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=o7(e._databaseId),s=(n=t.bundle,new uP(n,i)),a=s.t(),o=new lY(s.getMetadata(),i);for(let e of a)o.o(e);let l=o.documents;if(1!==l.length)throw new th(tu.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let u=sX(i,l[0].document),h=new tN(tC.fromString(t.bundleName));return new cS(e,new cn(e),h,u,new cT(!1,!1),r||null)}}cS._jsonSchemaVersion="firestore/documentSnapshot/1.0",cS._jsonSchema={type:tV("string",cS._jsonSchemaVersion),bundleSource:tV("string","DocumentSnapshot"),bundleName:tV("string"),bundle:tV("string")};class cC extends cS{data(e={}){return super.data(e)}}class cA{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new cT(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new cC(this._firestore,this._userDataWriter,r.key,r,new cT(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new th(tu.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new cC(e._firestore,e._userDataWriter,r.doc.key,r.doc,new cT(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new cC(e._firestore,e._userDataWriter,t.doc.key,t.doc,new cT(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ta(61501,{type:e})}}(t.type),doc:n,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new th(tu.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=cA._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=tb.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function cD(e,t,r){if(tB(t,cA._jsonSchema)){var n;if(t.bundle===c_)throw new th(tu.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let i=o7(e._databaseId),s=(n=t.bundle,new uP(n,i)),a=s.t(),o=new lY(s.getMetadata(),i);for(let e of a)o.o(e);if(1!==o.queries.length)throw new th(tu.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let l=ao(o.queries[0].bundledQuery),u=o.documents,h=new lF;u.map(e=>{let t=sX(i,e.document);h=h.add(t)});let c=lB.fromInitialDocuments(l,h,iK(),!1,!1),d=new u2(e,r||null,l);return new cA(e,new cn(e),d,c)}}function cN(e,t){return e instanceof cS&&t instanceof cS?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof cA&&t instanceof cA&&e._firestore===t._firestore&&u8(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}cA._jsonSchemaVersion="firestore/querySnapshot/1.0",cA._jsonSchema={type:tV("string",cA._jsonSchemaVersion),bundleSource:tV("string","QuerySnapshot"),bundleName:tV("string"),bundle:tV("string")};let ck={maxAttempts:5};class cR{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=hy(e)}set(e,t,r){this._verifyNotCommitted();let n=cO(e,this._firestore),i=cr(n.converter,t,r),s=hw(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,i7.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=cO(e,this._firestore);return i="string"==typeof(t=H(t))||t instanceof ho?hE(this._dataReader,"WriteBatch.update",s._key,t,r,n):hb(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,i7.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=cO(e,this._firestore);return this._mutations=this._mutations.concat(new su(t._key,i7.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new th(tu.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function cO(e,t){if((e=H(e)).firestore!==t)throw new th(tu.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class cM{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=hy(e)}get(e){let t=cO(e,this._firestore),r=new cn(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return ta(24041);let n=e[0];if(n.isFoundDocument())return new hB(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new hB(this._firestore,r,t._key,null,t.converter);throw ta(18433,{doc:n})})}set(e,t,r){let n=cO(e,this._firestore),i=cr(n.converter,t,r),s=hw(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=cO(e,this._firestore);return i="string"==typeof(t=H(t))||t instanceof ho?hE(this._dataReader,"Transaction.update",s._key,t,r,n):hb(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=cO(e,this._firestore);return this._transaction.delete(t._key),this}}class cL extends cM{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=cO(e,this._firestore),r=new hO(this._firestore);return super.get(e).then(e=>new cS(this._firestore,r,t._key,e._document,new cT(!1,!1),t.converter))}}function cP(e,t,r){var n,i;let s;e=tP(e,hr);let a={...ck,...r};if(a.maxAttempts<1)throw new th(tu.INVALID_ARGUMENT,"Max attempts must be at least 1");return n=hi(e),i=r=>t(new cL(e,r)),s=new tc,n.asyncQueue.enqueueAndForget(async()=>{let e=await uH(n);new uV(n.asyncQueue,e,a,i,s).ju()}),s.promise}function cF(e){e=tP(e,u6);let t=tP(e.firestore,hr);return uW(hi(t),e._key).then(r=>cY(t,e,r))}function cV(e){var t;let r;e=tP(e,u6);let n=tP(e.firestore,hr),i=hi(n),s=new hO(n);return(t=e._key,r=new tc,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await e.persistence.runTransaction("read document","readonly",r=>e.localDocuments.getDocument(r,t));n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new th(tu.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=lP(n,`Failed to get document '${t} from cache`);r.reject(e)}})(await uG(i),t,r)),r.promise).then(t=>new cS(n,s,e._key,t,new cT(null!==t&&t.hasLocalMutations,!0),e.converter))}function cB(e){e=tP(e,u6);let t=tP(e.firestore,hr);return uW(hi(t),e._key,{source:"server"}).then(r=>cY(t,e,r))}function cU(e){e=tP(e,u2);let t=tP(e.firestore,hr),r=hi(t),n=new hO(t);return hq(e._query),uJ(r,e._query).then(r=>new cA(t,n,e,r))}function cq(e){var t;let r;e=tP(e,u2);let n=tP(e.firestore,hr),i=hi(n),s=new hO(n);return(t=e._query,r=new tc,i.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await oA(e,t,!0),i=new l1(t,n.ks),s=i.ru(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=lP(n,`Failed to execute query '${t} against cache`);r.reject(e)}})(await uG(i),t,r)),r.promise).then(t=>new cA(n,s,e,t))}function cj(e){e=tP(e,u2);let t=tP(e.firestore,hr),r=hi(t),n=new hO(t);return uJ(r,e._query,{source:"server"}).then(r=>new cA(t,n,e,r))}function cz(e,t,r){e=tP(e,u6);let n=tP(e.firestore,hr),i=cr(e.converter,t,r),s=hy(n);return cJ(n,[hw(s,"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,i7.none())])}function c$(e,t,r,...n){e=tP(e,u6);let i=tP(e.firestore,hr),s=hy(i);return cJ(i,[("string"==typeof(t=H(t))||t instanceof ho?hE(s,"updateDoc",e._key,t,r,n):hb(s,"updateDoc",e._key,t)).toMutation(e._key,i7.exists(!0))])}function cG(e){return cJ(tP(e.firestore,hr),[new su(e._key,i7.none())])}function cK(e,t){let r=tP(e.firestore,hr),n=u4(e),i=cr(e.converter,t);return cJ(r,[hw(hy(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,i7.exists(!1))]).then(()=>n)}function cH(e,...t){var r;let n,i,s,a,o;e=H(e);let l={includeMetadataChanges:!1,source:"default"},u=0;"object"!=typeof t[0]||hP(t[u])||(l=t[u++]);let h={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(hP(t[u])){let e=t[u];t[u]=e.next?.bind(e),t[u+1]=e.error?.bind(e),t[u+2]=e.complete?.bind(e)}if(e instanceof u6)i=tP(e.firestore,hr),s=iT(e._key.path),n={next:r=>{t[u]&&t[u](cY(i,e,r))},error:t[u+1],complete:t[u+2]};else{let r=tP(e,u2);i=tP(r.firestore,hr),s=r._query;let a=new hO(i);n={next:e=>{t[u]&&t[u](new cA(i,a,r,e))},error:t[u+1],complete:t[u+2]},hq(e._query)}return r=hi(i),o=new lQ(s,a=new uM(n),h),r.asyncQueue.enqueueAndForget(async()=>lz(await uQ(r),o)),()=>{a.Nu(),r.asyncQueue.enqueueAndForget(async()=>l$(await uQ(r),o))}}function cQ(e,t,...r){var n,i,s,a,o,l;let u=H(e),h=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}(t);if(h.error)throw new th(tu.INVALID_ARGUMENT,h.error);let c,d=0;if("object"!=typeof r[0]||hP(r[d])||(c=r[d++]),"QuerySnapshot"===h.bundleSource){let e,t,a=null;if("object"==typeof r[d]&&hP(r[d])){let e=r[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:r[d++],error:r[d++],complete:r[d++]};return n=c,i=a,s=r[d],t=!1,hs(u,h.bundle).then(()=>{var e,t,r;return e=u,t=h.bundleName,(r=hi(e=tP(e,hr)),r.asyncQueue.enqueue(async()=>{var e;return e=await uG(r),e.persistence.runTransaction("Get named query","readonly",r=>e.Pi.getNamedQuery(r,t))})).then(t=>t?new u2(e,null,t.query):null)}).then(r=>{r&&!t&&(s&&r.withConverter(s),e=cH(r,n||{},i))}).catch(e=>(i.error&&i.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===h.bundleSource){let e,t,n=null;if("object"==typeof r[d]&&hP(r[d])){let e=r[d++];n={next:e.next,error:e.error,complete:e.complete}}else n={next:r[d++],error:r[d++],complete:r[d++]};return a=c,o=n,l=r[d],t=!1,hs(u,h.bundle).then(()=>{t||(e=cH(new u6(u,l||null,tN.fromPath(h.bundleName)),a||{},o))}).catch(e=>(o.error&&o.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new th(tu.INVALID_ARGUMENT,`unsupported bundle source: ${h.bundleSource}`)}function cW(e,t){let r,n=hi(e=tP(e,hr));return r=new uM(hP(t)?t:{next:t}),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await uQ(n),void(e.Ca.add(r),r.next())}),()=>{r.Nu(),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await uQ(n),void e.Ca.delete(r)})}}function cJ(e,t){var r;let n;return r=hi(e),n=new tc,r.asyncQueue.enqueueAndForget(async()=>ur(await uK(r),t,n)),n.promise}function cY(e,t,r){let n=r.docs.get(t._key),i=new hO(e);return new cS(e,i,t._key,n,new cT(r.hasPendingWrites,r.fromCache),t.converter)}function cX(e){return hi(e=tP(e,hr)),new cR(e,t=>cJ(e,t))}function cZ(e,t){let r=hi(e=tP(e,hr));if(!r._uninitializedComponentsProvider||"memory"===r._uninitializedComponentsProvider._offline.kind)return ti("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new th(tu.INVALID_ARGUMENT,"Failed to parse JSON: "+e?.message)}}(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=c0(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=hD("setIndexConfiguration",c0(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new tK(e,2)):"ASCENDING"===t.order?n.push(new tK(e,0)):"DESCENDING"===t.order&&n.push(new tK(e,1))}r.push(new tj(tj.UNKNOWN_ID,t,n,tH.empty()))}return r}(t);return r.asyncQueue.enqueue(async()=>(async function(e,t){let r=e.indexManager,n=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>r.getFieldIndexes(e).next(i=>(function(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])})(i,t,tG,t=>{n.push(r.addFieldIndex(e,t))},t=>{n.push(r.deleteFieldIndex(e,t))})).next(()=>t1.waitFor(n)))})(await uG(r),n))}function c0(e,t){if("string"!=typeof e[t])throw new th(tu.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class c1{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function c2(e){e=tP(e,hr);let t=c8.get(e);if(t)return t;let r=hi(e);if("persistent"!==r._uninitializedComponentsProvider?._offline.kind)return null;let n=new c1(e);return c8.set(e,n),n}function c6(e){c4(e,!0)}function c3(e){c4(e,!1)}function c5(e){var t;(t=hi(e._firestore)).asyncQueue.enqueue(async()=>{var e;let r;return r=(e=await uG(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}).then(e=>tr("deleting all persistent cache indexes succeeded")).catch(e=>ti("deleting all persistent cache indexes failed",e))}function c4(e,t){var r;(r=hi(e._firestore),r.asyncQueue.enqueue(async()=>{var e;return e=await uG(r),void(e.Cs.As=t)})).then(e=>tr(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>ti(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let c8=new WeakMap;class c7{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return c9.instance.onExistenceFilterMismatch(e)}}class c9{constructor(){this.i=new Map}static get instance(){return de||function(e){if(sw)throw Error("a TestingHooksSpi instance is already set");sw=e}(de=new c9),de}u(e){this.i.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.i;return r.set(t,e),()=>r.delete(t)}}let de=null;!function(e=!0){e9=eV,eC(new Q("firestore",(t,{instanceIdentifier:r,options:n})=>{let i=t.getProvider("app").getImmediate(),s=new hr(new tg(t.getProvider("auth-internal")),new tv(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new th(tu.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nD(e.options.projectId,t)}(i,r),i);return n={useFetchStreams:e,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),e$(hM,hL,void 0),e$(hM,hL,"esm2020")}(),e.s(["AggregateField",()=>hF,"AggregateQuerySnapshot",()=>hV,"DocumentSnapshot",()=>cS,"PersistentCacheIndexManager",()=>c1,"QueryCompositeFilterConstraint",()=>hH,"QueryConstraint",()=>hz,"QueryDocumentSnapshot",()=>cC,"QueryEndAtConstraint",()=>h3,"QueryFieldFilterConstraint",()=>hG,"QueryLimitConstraint",()=>hX,"QueryOrderByConstraint",()=>hJ,"QuerySnapshot",()=>cA,"QueryStartAtConstraint",()=>h1,"SnapshotMetadata",()=>cT,"Transaction",()=>cL,"WriteBatch",()=>cR,"_TestingHooks",()=>c7,"addDoc",()=>cK,"aggregateFieldEqual",()=>co,"aggregateQuerySnapshotEqual",()=>cl,"and",()=>hW,"average",()=>cs,"count",()=>ca,"deleteAllPersistentCacheIndexes",()=>c5,"deleteDoc",()=>cG,"disablePersistentCacheIndexAutoCreation",()=>c3,"documentSnapshotFromJSON",()=>cx,"enablePersistentCacheIndexAutoCreation",()=>c6,"endAt",()=>h4,"endBefore",()=>h5,"executeWrite",()=>cJ,"getAggregateFromServer",()=>ch,"getCountFromServer",()=>cu,"getDoc",()=>cF,"getDocFromCache",()=>cV,"getDocFromServer",()=>cB,"getDocs",()=>cU,"getDocsFromCache",()=>cq,"getDocsFromServer",()=>cj,"getPersistentCacheIndexManager",()=>c2,"limit",()=>hZ,"limitToLast",()=>h0,"memoryEagerGarbageCollector",()=>cg,"memoryLocalCache",()=>cy,"memoryLruGarbageCollector",()=>cm,"onSnapshot",()=>cH,"onSnapshotResume",()=>cQ,"onSnapshotsInSync",()=>cW,"or",()=>hQ,"orderBy",()=>hY,"persistentLocalCache",()=>cw,"persistentMultipleTabManager",()=>cI,"persistentSingleTabManager",()=>cE,"query",()=>h$,"querySnapshotFromJSON",()=>cD,"runTransaction",()=>cP,"setDoc",()=>cz,"setIndexConfiguration",()=>cZ,"snapshotEqual",()=>cN,"startAfter",()=>h6,"startAt",()=>h2,"sum",()=>ci,"updateDoc",()=>c$,"where",()=>hK,"writeBatch",()=>cX],8602),e.s([],97173),e.i(8602),e.s(["Timestamp",()=>tU,"collection",()=>u5,"doc",()=>u4,"getFirestore",()=>hn,"limit",()=>hZ,"onSnapshot",()=>cH,"orderBy",()=>hY,"query",()=>h$],26915);let dt={apiKey:"AIzaSyBhdos3JjsCF6K3xm7nF2EfmMJ2GVkXbxU",authDomain:"silverline-bdd-test-dashboard.firebaseapp.com",projectId:"silverline-bdd-test-dashboard",storageBucket:"silverline-bdd-test-dashboard.firebasestorage.app",messagingSenderId:"863266047324",appId:"1:863266047324:web:493bc106be7372c92e6d99"};function dr(){return hn(0===ej().length?eB(dt):ej()[0])}e.s(["getDb",()=>dr],75724),e.s(["sanitizeTimestamps",()=>function e(t){let r={};for(let[n,i]of Object.entries(t))i instanceof tU?r[n]=i.toDate().toISOString():i&&"object"==typeof i&&!Array.isArray(i)?r[n]=e(i):Array.isArray(i)?r[n]=i.map(t=>t instanceof tU?t.toDate().toISOString():t&&"object"==typeof t?e(t):t):r[n]=i;return r}],96364)}]);